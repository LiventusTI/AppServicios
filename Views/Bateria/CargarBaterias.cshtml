
@{
    ViewBag.Title = "CargarBaterias";
    Layout = "~/Views/MasterPage.cshtml";
}


<div class="col-lg-12 col-md-12 col-sm-12">
    <h2 class="tr" key="cargarbaterias">Cargar Baterías</h2>
    <br />

    <div class="col-lg-3 col-md-3 col-sm-3">
    </div>
    <div class="col-lg-3 col-md-3 col-sm-3">
        <label class="control-label tr" key="cargamasivaingreso">Carga masiva de baterías</label>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-3">
        <input type="file" id="ArchivoSalida" name="Archivo" placeholder="Suba Archivo Excel" class="form-control">
    </div>
    <div class="col-lg-1 col-md-1 col-sm-1">
        <a title="Subir Archivo" id="SubirArchivoSalida" name="SubirArchivo" class="SubirArchivoSalida"><i class="fa fa-upload fa-2x"></i></a>
    </div>
</div>


<script>

    $(".SubirArchivoSalida").click(function () {
        if ($('#ArchivoSalida').val() != "") {
            $("#ArchivoSalida").css("background", "rgba(255, 0, 0, 0)");
            var fileUpload = document.getElementById("ArchivoSalida");
            if (fileUpload.value != null) {
                var uploadFile = new FormData();
                var files = $("#ArchivoSalida").get(0).files;
                // Add the uploaded file content to the form data collection
                if (files.length > 0) {
                    uploadFile.append("resultadoPruebaBateria", files[0]);
                    $.ajax({
                        url: '@Url.Action("LeerExcelBaterias", "Bateria")',
                        contentType: false,
                        processData: false,
                        data: uploadFile,
                        type: 'POST',
                        success: function (response) {
                            var data = [];
                            var json = JSON.parse(response);
                            var cuenta = json.length;
                            if (cuenta != 0) {
                                if (json[0].NumBateria == undefined) {
                                    swal('Ups!', '<span> Error de Extensión del archivo.</span>', 'error');
                                    return false;
                                } else {
                                    swal({
                                        title: 'OK!',
                                        type: 'success',
                                        html:
                                                "<span> Baterías cargadas correctamente.</span>",
                                        confirmButtonText: 'Aceptar',
                                    }).then((result) => {
                                        if (result == true) {
                                            location.reload();
                                        }
                                    })
                                }
                            } else {
                                swal('Ups!', '<span> Archivo no cumple con el formato correcto.</span>', 'error');
                                return false;
                            }
                        }
                    });
                }
            }
        } else {
            $("#ArchivoIngreso").css("background", "rgba(255, 0, 0, 0.4)");
        }
    });


</script>
