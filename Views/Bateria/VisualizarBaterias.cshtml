
@{
    ViewBag.Title = "VisualizarBaterias";
    Layout = "~/Views/MasterPage.cshtml";
    int PerfilInterior = Convert.ToInt32(Session["PerfilInterior"]);
    string Usuario = Session["User"].ToString().ToUpper();
}

<div class="col-sm-12">
    <div class="x_panel">
        <div class="x_title">
            <div class="row">
                <div class="col-sm-7">
                    <h2 class="tr" key="titulobaterias">Alertas/Agregar/Asociar/Descartar Baterías</h2>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>

        <div class="x_content">
            <div class="x_panel">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <div class="col-lg-3 col-md-3 col-sm-12" style="text-align:center">
                            <label class="control-label tr">Reglas de negocio asociadas: </label>
                            <i title="Descripción de reglas de negocio:
                               Se podrá asociar una batería a un equipo sólo si no se encuentra en estado descartada.
                               Las baterías pueden vencer por los siguientes casos:
                                    - Si una batería es asociada a un controlador y transcurren 14 días sin que el controlador haya sido asignado a un servicio.
                                    - Si una batería es asociada a un controlador y el controlador es asociado a un servicio que posee un ETA POD
                                      tal que supera los 50 días considerando tiempo de tránsito.
                                    - Si una batería es asociada a un modem y transcurren 85 días sin que el modem haya sido asignado a un servicio.
                                    - Si una batería es asociada a un modem y el modem es asociado a un servicio que posee un ETA POD
                                      tal que supera los 125 días considerando tiempo de tránsito." class="fa fa-info-circle"></i>
                        </div>
                    </div>

                    <div class="col-sm-12 col-md-12 col-lg-12" id="tablaBaterias">
                        <table id="Tb_Servicios" class="table table-striped table-bordered display nowrap">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th class="tr" key="estado">ALERTA/ESTADO</th>
                                    <th class="tr" key="ibbateria">N° BATERIA</th>
                                    <th class="tr" key="modelobateria">MODELO BATERIA</th>
                                    <th class="tr" key="usuariobcoprueba">USUARIO BCO. PRUEBA</th>
                                    <th class="tr" key="tipoequipo">TIPO EQUIPO ASOCIADO</th>
                                    <th class="tr" key="esnequipo">ESN EQUIPO ASOCIADO</th>
                                    <th class="tr" key="fechaasociacion">FECHA ASOCIACION BATERIA</th>
                                    <th class="tr" key="diasparavencer">DIAS DESDE ASOCIACION</th>
                                    <th class="tr" key="">DIAS CONSUMO TRAVELING</th>
                                    <th class="tr" key="">DIAS CONSUMO SLEEP</th>
                                </tr>
                                <tr>
                                    <th></th>
                                    <th class="tr" key="estado">ALERTA/ESTADO</th>
                                    <th class="tr" key="ibbateria">N° BATERIA</th>
                                    <th class="tr" key="modelobateria">MODELO BATERIA</th>
                                    <th class="tr" key="usuariobcoprueba">USUARIO BCO. PRUEBA</th>
                                    <th class="tr" key="tipoequipo">TIPO EQUIPO ASOCIADO</th>
                                    <th class="tr" key="esnequipo">ESN EQUIPO ASOCIADO</th>
                                    <th class="tr" key="fechaasociacion">FECHA ASOCIACION BATERIA</th>
                                    <th class="tr" key="diasparavencer">DIAS DESDE ASOCIACION</th>
                                    <th class="tr" key="">DIAS CONSUMO TRAVELING</th>
                                    <th class="tr" key="">DIAS CONSUMO SLEEP</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th></th>
                                    <th class="tr" key="estado">1. ALERTA/ESTADO</th>
                                    <th class="tr" key="ibbateria">2. N° BATERIA</th>
                                    <th class="tr" key="modelobateria">3. MODELO BATERIA</th>
                                    <th class="tr" key="usuariobcoprueba">4. USUARIO BCO. PRUEBA</th>
                                    <th class="tr" key="tipoequipo">5. TIPO EQUIPO ASOCIADO</th>
                                    <th class="tr" key="esnequipo">6. ESN EQUIPO ASOCIADO</th>
                                    <th class="tr" key="fechaasociacion">7. FECHA ASOCIACION BATERIA</th>
                                    <th class="tr" key="diasparavencer">8. DIAS DESDE ASOCIACION</th>
                                    <th class="tr" key="">9. DIAS CONSUMO TRAVELING</th>
                                    <th class="tr" key="">10. DIAS CONSUMO SLEEP</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                </div>
                <div class="row" id="botonesacciones">
                    <div class="col-lg-11 col-lg-offset-1">
                        <button type="button" class="btn btn-success tr btn-sm" key="CargarBateria" id="CargarBateria">Cargar Nuevas Baterías</button>
                        <button class="btn btn-primary tr btn-primary btn-sm" key="DescartarBateria" id="DescartarBateria">Descartar o Des-descartar baterías</button>
                        <button class="btn btn-info tr btn-info btn-sm" key="AsociarBateria" id="AsociarBateria">Asociar/Editar Asociación batería a equipo</button>
                        <button class="btn btn-info tr btn-warning btn-sm" key="DesasociarBateria" id="DesasociarBateria">Desasociar batería a equipo</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Modal Carga Baterias-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="margin-left:80px; margin-right:10px;">
        <div class="modal-dialog" role="document" style="width:100%">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h2 class="modal-title tr" id="myModalLabel" key="tituloposturacortinaagregar">Carga Nuevas Baterías</h2>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12">
                            <div class="col-lg-3 col-md-3 col-sm-3">
                                <label class="control-label tr" key="cargamasivaingreso">Carga masiva de baterías por banco de pruebas</label>
                            </div>
                            <div class="col-lg-3 col-md-3 col-sm-3">
                                <input type="file" id="ArchivoSalida" name="Archivo" placeholder="Suba Archivo Excel" class="form-control">
                            </div>
                            <div class="col-lg-1 col-md-1 col-sm-1">
                                <a title="Subir Archivo" id="SubirArchivoSalida" name="SubirArchivo" class="SubirArchivoSalida"><i class="fa fa-upload fa-2x"></i></a>
                            </div>
                        </div>
                    </div>

                </div>
                @*<div class="modal-footer" style="text-align:center">
                        <button type="button" class="btn btn-success btn-lg" id="EditarDatos">Guardar</button>
                    </div>*@
            </div>
        </div>
    </div>
    <!-- Modal Carga Baterias -->
    <!--Modal para Asociar Bateria-->
    <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="margin-left:80px; margin-right:10px;">
        <div class="modal-dialog" role="document" style="width:100%">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title tr" id="myModalLabel" key="titulologisticacontrolador"> Asociar Bateria a un equipo</h4>
                </div>
                <div class="modal-body">
                    <div class="row x_panel">
                        <div id="Log_salida">
                            <div class="x_panel">
                                <div class="alert alert-info row" role="alert">
                                    <i class="glyphicon glyphicon-info-sign fa-2x" style="vertical-align:middle;"></i>
                                    <span style="vertical-align:middle;">Cabe señalar que si un controlador esta asociado a un servicio, se cambiará el estado del servicio a <b>"ARRIVED"</b>.</span>
                                </div>
                            </div>
                            <div class="x_panel">
                                <form class="form-horizontal">
                                    <div class="col-lg-12 col-md-12 col-sm-12 form-group">
                                        <div class="col-lg-3 col-md-3 col-sm-3">
                                            <label id="lb_id" class="control-label tr" key="tipoesn">Batería seleccionada</label>
                                        </div>
                                        <div class="col-md-3 col-sm-3 col-xs-3">
                                            <input type="text" disabled="disabled" class="form-control" name="BateriaSeleccionada" id="BateriaSeleccionada" />
                                        </div>
                                        <div class="col-lg-1 col-md-1 col-sm-1">
                                        </div>
                                    </div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 form-group">
                                        <div class="col-lg-3 col-md-3 col-sm-3">

                                            <label id="lb_id" class="control-label tr" key="tiponodoingreso">Número ESN  (*)</label>
                                        </div>
                                        <div class="col-md-3 col-sm-3 col-xs-3">
                                            <input type="text" onkeyup="this.value = this.value.toUpperCase();" class="form-control" autocomplete="off" name="ESN" id="ESN" />
                                        </div>

                                        <div class="col-lg-1 col-md-1 col-sm-1">
                                            <label id="lb_id" class="control-label tr" key="tipoesn">Tipo Equipo (*)</label>
                                        </div>
                                        <div class="col-md-3 col-sm-3 col-xs-3">
                                            <select class="selectpicker form-control" id="tipo_esn" data-live-search="true">
                                                <option value="0" selected>Seleccione Tipo ESN</option>
                                                <option value="1">CONTROLADOR</option>
                                                <option value="2">MODEM</option>
                                            </select>
                                        </div>
                                        <div class="col-lg-1 col-md-1 col-sm-1">
                                        </div>



                                    </div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 form-group">
                                        <div class="col-lg-3 col-md-3 col-sm-3">
                                            <label id="lb_id" class="control-label">Fecha Asociación (*)</label>
                                        </div>
                                        <div class="col-md-3 col-sm-3 col-xs-3">
                                            <input type="text" id="FechaAsociacion" class="form-control" autocomplete="off">
                                        </div>
                                        <div class="col-lg-1 col-md-1 col-sm-1">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="div_botones_salida">
                    <button type="button" class="btn btn-success tr" id="Guardar_asociacion" key="botonguardarasociacion">Guardar</button>
                    <button type="button" class="btn btn-danger tr" data-dismiss="modal" key="botoncancelarlogistica">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal para Asociar Bateria-->

    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" id="CargarBateriasTrigger" style="display:none;"></button>
    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal2" id="AsociarBateriaTrigger" style="display:none;"></button>

    <script src="~/build/js/Perfiles.js"></script>

    <script type="text/javascript">

    var lenguaje = document.cookie;

    function formatDate(date) {
        if (date != null) {
            var fecha = date.substring(0, 10);
            var ano = date.substring(0, 4);
            var mes = date.substring(5, 7);
            var dia = date.substring(8, 10);
            return dia + "-" + mes + "-" + ano;
        } else {
            return "";
        }
    }

    $(document).ready(function () {

        $('#Tb_Servicios thead tr:eq(1) th').each( function (i) {
            var title = $('#example thead tr:eq(0) th').eq( $(this).index() ).text();
            if($(this).index() != 0){
                $(this).html( '<input type="text" class="form-control" placeholder="FILTER" data-index="'+i+'"/>' );
            }
        });

        var table = $("#Tb_Servicios").DataTable({
            initComplete: function () {
                this.api().columns().every(function () {
                    var column = this;
                    if (column.index() == 1) {
                        //alert(column.index());

                        var select = $('<select><option value=""></option></select>')
                            .appendTo($(column.footer()).empty())
                            .on('change', function () {
                                var val = $.fn.dataTable.util.escapeRegex(
                                    $(this).val()
                                );

                                column
                                    .search(val ? '^' + val + '$' : '', true, false)
                                    .draw();
                            });

                        column.data().unique().sort().each(function (d, j) {
                            select.append('<option value="' + d + '">' + d + '</option>')
                        });
                    }
                });
            },
            orderCellsTop:  true,
            fixedColumns:   true,
            scrollX: true,
            pageLength: 15,
            ajax: {
                "url": "@Url.Action("GetBaterias", "Bateria")",
                "dataSrc": ''
            },
            dom: 'Bfrtip',
            buttons: [
                {
                    extend: 'excel',
                    exportOptions: {
                        columns: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
                        orthogonal: 'export'
                    },
                }
            ],
            "rowCallback": function (row, data, index) {
                if (data.Estado.indexOf("VENCIDA") > -1) {
                    $('td', row).css("background-color", "rgba(255, 0, 0, 0.4);"); //ROJO
                } else if (data.Estado.indexOf("VENCERA PREVIO A ETA POD") > -1) {
                    $('td', row).css("background-color", "rgba(255, 0, 0, 0.4);"); //ROJO
                } else if (data.Estado.indexOf("BATERIA HOWELL ASOCIADA A CONTROLADOR") > -1) {
                    $('td', row).css("background-color", "rgba(255, 0, 0, 0.4);"); //ROJO
                } else if (data.Estado.indexOf("BATERIA RECHAZADA ASOCIADA A EQUIPO") > -1) {
                    $('td', row).css("background-color", "rgba(255, 0, 0, 0.4);"); //ROJO
                }
            },
        columns: [
            { "data": "Checkbox" },
            { "data": "Estado"},
            { "data": "NumBateria" },
             { "data": "Modelo" },
            { "data": "UsuarioPrueba" },
            { "data": "TipoESN" },
            { "data": "ESN" },
            {
                "data": "FechaAsociacion",
                "render":
                  function (data, type, row, meta) {
                      if (data != null) {
                          var fecha = FormatDate(data);
                          return fecha;
                      } else {
                          return "";
                      }
                  }
            },
            { "data": "DiasInstalacion" },
            { "data": "CONT_DIAS_TRAVELING" },
            { "data": "CONT_DIAS_SLEEP" },
        ],
        columnDefs: [
            {
                'targets': 0,
                'checkboxes': {
                    'selectRow': true
                }
            }
        ],
        select: {
            'style': 'multi'
        },
        });

        $( table.table().container() ).on('keyup', 'thead input', function () {
            table
                .column( $(this).data('index'))
                .search( this.value )
                .draw();
        });

        $('#example-select-all').on('click', function(){
            // Get all rows with search applied
            var rows = table.rows({ 'search': 'applied' }).nodes();
            // Check/uncheck checkboxes for all rows in the table
            $('input[type="checkbox"]', rows).prop('checked', this.checked);
        });

        $(function () {
            $("#FechaAsociacion").datepicker({
                dateFormat: "dd-mm-yy",
                firstDay: 1,
                dayNamesMin: ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"],
                dayNamesShort: ["Dom", "Lun", "Mar", "Mie", "Jue", "Vie", "Sab"],
                monthNames:
                    ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio",
                    "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
                monthNamesShort:
                    ["Ene", "Feb", "Mar", "Abr", "May", "Jun",
                    "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
                showWeek: true
            });
        });

        function FormatDate(data) {
            var dateString = data.substr(6);
            var currentTime = new Date(parseInt(dateString));
            var month = currentTime.getMonth() + 1;
            var day = currentTime.getDate();
            var year = currentTime.getFullYear();

            if (month < 10) {
                month = "0" + month;
            } else {
                month;
            }

            if (day < 10) {
                day = "0" + day;
            } else {
                day;
            }

            var date = day + "-" + month + "-" + year;
            return date;
        }

    });

    $("#CargarBateria").click(function () {
        $('#CargarBateriasTrigger').trigger('click');
    });

    $("#Guardar_asociacion").click(function () {
        if ($("#ESN").val() == "") {
            $("#ESN").css("background-color", "rgba(255, 0, 0, 0.4)");
            $("button[data-id=tipo_esn]").css("background", "rgba(255, 0, 0, 0)");
            $("#FechaAsociacion").css("background-color", "rgba(255, 0, 0, 0)");
        } else if ($("#tipo_esn").val() == "0") {
            $("#ESN").css("background-color", "rgba(255, 0, 0, 0)");
            $("button[data-id=tipo_esn]").css("background", "rgba(255, 0, 0, 0.4)");
            $("#FechaAsociacion").css("background-color", "rgba(255, 0, 0, 0)");
        } else if ($("#FechaAsociacion").val() == "" ) {
            $("#ESN").css("background-color", "rgba(255, 0, 0, 0)");
            $("button[data-id=tipo_esn]").css("background", "rgba(255, 0, 0, 0)");
            $("#FechaAsociacion").css("background-color", "rgba(255, 0, 0, 0.4)");
        } else
        {
            var tipoESN="";
            if ($('#tipo_esn').val()=="1")
            {
                tipoESN = "CONTROLADOR";
            } else
            {
                tipoESN = "MODEM";
            }
            $.ajax({
                type: "POST",
                url: '@Url.Action("AsociarBateria", "Bateria")',
                data: {
                    NumBateria: $('#BateriaSeleccionada').val(),
                    ESN: $('#ESN').val(),
                    TipoESN: tipoESN,
                    FechaAsociacion: $("#FechaAsociacion").val()
                },
                success: function (response) {

                    var json = JSON.parse(response);
                    if (json.validador == 0) {
                        var aux = 'success';
                    } else {
                        var aux = 'warning';
                    }
                    swal({
                        title: '',
                        text: json.Mensaje,
                        type: aux,
                        showCancelButton: false,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Aceptar'
                    }).then((result) => {
                        location.reload();
                    })
                }
            });
        }
    });

    $("#AsociarBateria").click(function () {
        var Baterias = [];
        var count = 0;
        var cuenta = $("#Tb_Servicios tbody tr").length;
        //var cuenta = 1;
        var bool = true;
        var bateriaSeleccionada = "";
        var tipoESN = "";
        var ESN = "";
        var fechaAsociacion
        var cantBaterias = 0;
        var estado = "";
        $("#Tb_Servicios tbody tr").each(function () {
            if ($(this).find(".dt-checkboxes").is(":checked")) {
                cantBaterias = cantBaterias + 1;
                estado = $(this).find("td:eq(1)").html();
                bateriaSeleccionada = $(this).find("td:eq(2)").html();
                tipoESN = $(this).find("td:eq(5)").html();
                ESN = $(this).find("td:eq(6)").html();
                fechaAsociacion = $(this).find("td:eq(7)").html();
            } else {
                count = count + 1;
                if (count == cuenta) {
                    swal('Ups!', 'Debe seleccionar al menos una batería.', 'error');
                    return false;
                }
            }
        });
        if (cantBaterias > 1)
        {
            swal('Ups!', '<span> Puedes asociar solo una batería a un equipo.</span>', 'error');
        } else if (cantBaterias==1)
        {
            if (estado == "DESCARTADA") {
                swal('Ups!', 'No puedes asociar un equipo a una batería descartada.', 'error');
                return false;
            }
            $('#BateriaSeleccionada').val(bateriaSeleccionada);

            if (tipoESN == "CONTROLADOR")
            {
                $('#tipo_esn').val("1");
                $("#tipo_esn").prop("disabled", false);
                $('#tipo_esn').selectpicker('refresh');
            } else if (tipoESN == "MODEM")
            {
                $('#tipo_esn').val("2");
                $("#tipo_esn").prop("disabled", false);
                $('#tipo_esn').selectpicker('refresh');
            }
            else
            {
                $('#tipo_esn').val("0");
                $("#tipo_esn").prop("disabled", false);
                $('#tipo_esn').selectpicker('refresh');
            }

            $('#ESN').val(ESN);
            $('#FechaAsociacion').val(fechaAsociacion);
            $('#AsociarBateriaTrigger').trigger('click');
        }

    });



    $("#DesasociarBateria").click(function () {
        var count = 0;
        var cuenta = $("#Tb_Servicios tbody tr").length;
        //var cuenta = 1;
        var bool = true;
        var bateriaSeleccionada = "";
        var tipoESN = "";
        var ESN = "";
        var fechaAsociacion
        var cantBaterias = 0;
        $("#Tb_Servicios tbody tr").each(function () {
            if ($(this).find(".dt-checkboxes").is(":checked")) {
                cantBaterias = cantBaterias + 1;
                bateriaSeleccionada = $(this).find("td:eq(2)").html();
                tipoESN = $(this).find("td:eq(5)").html();
                ESN = $(this).find("td:eq(6)").html();
                fechaAsociacion = $(this).find("td:eq(7)").html();
            } else {
                count = count + 1;
                if (count == cuenta) {
                    swal('Ups!', 'Debe seleccionar al menos una batería.', 'error');
                    return false;
                }
            }
        });
        if (cantBaterias > 1) {
            swal('Ups!', '<span> Puedes Desasociar solo una batería a un equipo.</span>', 'error');
        } else if (cantBaterias == 1) {
            $.ajax({
                type: "POST",
                url: '@Url.Action("DesasociarBateria", "Bateria")',
                data: {
                    NumBateria: bateriaSeleccionada,
                    ESN: ESN,
                    TipoESN: tipoESN
                },
                success: function (response) {

                    var json = JSON.parse(response);
                    if (json.validador == 0) {
                        var aux = 'success';
                    } else {
                        var aux = 'warning';
                    }
                    swal({
                        title: '',
                        text: json.Mensaje,
                        type: aux,
                        showCancelButton: false,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Aceptar'
                    }).then((result) => {
                        location.reload();
                    })
                }
            });
        }

    });


    $("#ESN").blur(function () {
        $.ajax({
            type: "POST",
            url: '@Url.Action("ValidarTipoESN", "Controlador")',
            data: {
                ESN: $('#ESN').val()
            },
            success: function (response) {
                if(response=="CONTROLADOR")
                {
                    $('#tipo_esn').val("1");
                    $('#tipo_esn').selectpicker('refresh');
                    $("#tipo_esn").prop("disabled", true);
                }else if (response=="MODEM")
                {
                    $('#tipo_esn').val("2");
                    $('#tipo_esn').selectpicker('refresh');
                    $("#tipo_esn").prop("disabled", true);
                }else
                {
                    $('#tipo_esn').val("0");
                    $("#tipo_esn").prop("disabled", false);
                    $('#tipo_esn').selectpicker('refresh');
                    $('#ESN').val("");
                    swal('Ups!', 'No existe registro de controlador o modem con el número de ESN ingresado.', 'error');
                    return false;
                }

            }
        });
    });




    $("#DescartarBateria").click(function () {
        var Baterias = [];
        var count = 0;
        var cuenta = $("#Tb_Servicios tbody tr").length;
        //var cuenta = 1;
        var bool = true;
        var cantBaterias = 0;
        $("#Tb_Servicios tbody tr").each(function () {
            if ($(this).find(".dt-checkboxes").is(":checked")) {
                Baterias.push($(this).find("td:eq(2)").html());
                cantBaterias=cantBaterias + 1;
            } else {
                count = count + 1;
                if (count == cuenta) {
                    swal('Ups!', 'Debe seleccionar al menos una batería.', 'error');
                    return false;
                }
            }
        });
        if (count != cuenta && bool == true) {
            swal({
                title: 'Estas seguro que deseas descartar o des-descartar las ' + cantBaterias + ' baterías?',
                text: '',
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si'
            }).then((result) => {

                if (cantBaterias != 0) {
                    for (var i = 0; i < Baterias.length ; i++) {
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("DescartarBateria", "Bateria")',
                            data: {
                                NumBateria: Baterias[i]
                            },
                            success: function (response) {
                                var json = JSON.parse(response);
                                if (json.validador == 0) {
                                    var aux = 'success';
                                } else {
                                    var aux = 'warning';
                                }

                            }
                        });
                    }
                } else {
                    swal('Ups!', '<span> Error en la selección de datos.</span>', 'error');
                }

                location.reload();
            });
        }




    });

    $(".SubirArchivoSalida").click(function () {
        if ($('#ArchivoSalida').val() != "") {
            $("#ArchivoSalida").css("background", "rgba(255, 0, 0, 0)");
            var fileUpload = document.getElementById("ArchivoSalida");
            if (fileUpload.value != null) {
                var uploadFile = new FormData();
                var files = $("#ArchivoSalida").get(0).files;
                // Add the uploaded file content to the form data collection
                if (files.length > 0) {
                    uploadFile.append("resultadoPruebaBateria", files[0]);
                    $.ajax({
                        url: '@Url.Action("LeerExcelBaterias", "Bateria")',
                        contentType: false,
                        processData: false,
                        data: uploadFile,
                        type: 'POST',
                        success: function (response) {
                            var data = [];
                            var json = JSON.parse(response);
                            var cuenta = json.length;
                            if (cuenta != 0) {
                                if (json[0].NumBateria == undefined) {
                                    swal('Ups!', '<span> Error de Extensión del archivo.</span>', 'error');
                                    return false;
                                } else {
                                    swal({
                                        title: 'OK!',
                                        type: 'success',
                                        html:
                                                "<span> Baterías cargadas correctamente.</span>",
                                        confirmButtonText: 'Aceptar',
                                    }).then((result) => {
                                        if (result == true) {
                                            location.reload();
                                        }
                                    })
                                }
                            } else {
                                swal('Ups!', '<span> Archivo no cumple con el formato correcto.</span>', 'error');
                                return false;
                            }
                        }
                    });
                }
            }
        } else {
            $("#ArchivoIngreso").css("background", "rgba(255, 0, 0, 0.4)");
        }
    });


    </script>
