@{
    ViewBag.Title = "VisualizarHistoricoServicios";
    Layout = "~/Views/MasterPage.cshtml";
    int PerfilInterior = Convert.ToInt32(Session["PerfilInterior"]);
    string Usuario = Session["User"].ToString().ToUpper();
}

<div class="col-sm-12">
    <div class="x_panel">
        <div class="x_title">
            <div class="row">
                <div class="col-sm-7">
                    <h2 class="tr" key="historicoservicios">Historico Servicios</h2>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>       
        <div class="x_content">
             <div class="x_panel">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <table id="Tb_Servicios" class="table table-striped table-bordered display nowrap">
                        <thead>
                            <tr>
                                <th class="tr" key="idreserva">ID RESERVA</th>
                                <th>BOOKING</th>
                                <th class="tr" key="navierasolicitud">NAVIERA</th>
                                <th class="tr" key="naveservicio">ULTIMA NAVE</th>
                                <th class="tr" key="viajereserva">VIAJE</th>
                                <th class="tr" key="exportadorreserva">EXPORTADOR</th>
                                <th class="tr" key="fecharegistroreserva">FECHA DE REGISTRO</th>
                                <th class="tr" key="iniciostackingreserva">INICIO STACKING</th>
                                <th class="tr" key="terminostackingreserva">TERMINO STACKING</th>
                                <th>ETD</th>
                                <th>ETA</th>
                                <th>COMMODITY</th>
                                <th class="tr" key="puertoorigenreserva">PUERTO ORIGEN</th>
                                <th class="tr" key="puertoorigenreserva">PUERTO DESTINO</th>
                                <th>SET POINT</th>
                                <th>TEMPERATURA</th>
                                <th >ID SERVICIO</th>
                                <th >N° CONTENEDOR</th>
                                <th class="tr" key="estadoservicio">ESTADO SERVICIO</th>
                                <th>MOVIMIENTO CONTENEDOR</th>
                                <th>ALERTA</th>
                            </tr>
                            <tr>
                                <th class="tr" key="idreserva">ID RESERVA</th>
                                <th>BOOKING</th>
                                <th class="tr" key="navierasolicitud">NAVIERA</th>
                                <th class="tr" key="naveservicio">ULTIMA NAVE</th>
                                <th class="tr" key="viajereserva">VIAJE</th>
                                <th class="tr" key="exportadorreserva">EXPORTADOR</th>
                                <th class="tr" key="fecharegistroreserva">FECHA DE REGISTRO</th>
                                <th class="tr" key="iniciostackingreserva">INICIO STACKING</th>
                                <th class="tr" key="terminostackingreserva">TERMINO STACKING</th>
                                <th>ETD</th>
                                <th>ETA</th>
                                <th>COMMODITY</th>
                                <th class="tr" key="puertoorigenreserva">PUERTO ORIGEN</th>
                                <th class="tr" key="puertoorigenreserva">PUERTO DESTINO</th>
                                <th>SET POINT</th>
                                <th>TEMPERATURA</th>
                                <th >ID SERVICIO</th>
                                <th >N° CONTENEDOR</th>
                                <th class="tr" key="estadoservicio">ESTADO SERVICIO</th>
                                <th>MOVIMIENTO CONTENEDOR</th>
                                <th>ALERTA</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th class="tr" key="idreserva">ID RESERVA</th>
                                <th>BOOKING</th>
                                <th class="tr" key="navierasolicitud">NAVIERA</th>
                                <th class="tr" key="naveservicio">ULTIMA NAVE</th>
                                <th class="tr" key="viajereserva">VIAJE</th>
                                <th class="tr" key="exportadorreserva">EXPORTADOR</th>
                                <th class="tr" key="fecharegistroreserva">FECHA DE REGISTRO</th>
                                <th class="tr" key="iniciostackingreserva">INICIO STACKING</th>
                                <th class="tr" key="terminostackingreserva">TERMINO STACKING</th>
                                <th>ETD</th>
                                <th>ETA</th>
                                <th>COMMODITY</th>
                                <th class="tr" key="puertoorigenreserva">PUERTO ORIGEN</th>
                                <th class="tr" key="puertoorigenreserva">PUERTO DESTINO</th>
                                <th>SET POINT</th>
                                <th>TEMPERATURA</th>
                                <th >ID SERVICIO</th>
                                <th >N° CONTENEDOR</th>
                                <th class="tr" key="estadoservicio">ESTADO SERVICIO</th>
                                <th>MOVIMIENTO CONTENEDOR</th>
                                <th>ALERTA</th>
                            </tr>
                            <tr>
                                <th colspan="15" class="tr" key="datosdelareservahistorico">DATOS DE LA RESERVA</th>
                                <th colspan="6" class="tr" key="identificaciontablaservicio">IDENTIFICACION</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/build/js/Perfiles.js"></script>
<script type="text/javascript">

    $(document).ready(function () {

        $('#Tb_Servicios thead tr:eq(1) th').each(function (i) {
            var title = $('#example thead tr:eq(0) th').eq($(this).index()).text();
            $(this).html('<input type="text" class="form-control" placeholder="FILTER" data-index="' + i + '"/>');
        });
        
        var table = $("#Tb_Servicios").DataTable({
            orderCellsTop: true,
            fixedColumns: true,
            scrollX: true,
            order: false,
            pageLength: 15,
            ajax: {
                "url": "@Url.Action("GetHistoricoServiciosMsc", "Reservas")",
                "dataSrc": ''
            },
            dom: 'Bfrtip',
            buttons: [
                {
                   extend: 'excel',
                   exportOptions: {
                       columns: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11,12,13,14,15,16,17,18,19]
                   },
                }           
            ],
            "rowCallback": function (row, data, index) {
                if (data.EstadoServicio == "CANCELLED") {
                    $('td', row).css("background-color", "rgba(255,255,0)");
                } else if (data.EstadoServicio == "ON SERVICE TRIP" || data.EstadoServicio == "NOT RECOVERED" || data.EstadoServicio == "RECOVERED") {
                    $('td', row).css("background-color", "rgba(0,255,0,0.6)");
                } else if (data.EstadoServicio == "RESERVED") {
                    if (data.Alerta == "1") {
                        $('td', row).css("background-color", "rgba(250, 190, 88, 1)");
                    } else if (data.Alerta == "2") {
                        $('td', row).css("background-color", "rgba(213, 184, 255, 1)");
                    }
                }
            },
            columns: [
                { "data": "IdReserva" },
                { "data": "Booking" },
                { "data": "Naviera" },
                { "data": "UltimaNave" },
                { "data": "Viaje" },
                { "data": "Exportador" },
                {
                    "data": "FechaRegistro",
                    "render":
                      function (data, type, row, meta) {
                          if (data != null) {
                              var fecha = FormatDate(data);
                              return fecha;
                          } else {
                              return "";
                          }
                      }
                },
                {
                    "data": "FechaIniStacking",
                    "render":
                    function (data, type, row, meta) {
                        if (data != null) {
                            var fecha = FormatDate(data);
                            return fecha;
                        } else {
                            return "";
                        }
                    }
                },
                {
                    "data": "FechaFinStacking",
                    "render":
                    function (data, type, row, meta) {
                        if (data != null) {
                            var fecha = FormatDate(data);
                            return fecha;
                        } else {
                            return "";
                        }
                    }
                },
                {
                    "data": "Etd",
                    "render":
                      function (data, type, row, meta) {
                          if (data != null) {
                              var fecha = FormatDate(data);
                              return fecha;
                          } else {
                              return "";
                          }
                      }
                },
                {
                    "data": "EtaPuerto",
                    "render":
                        function (data, type, row, meta) {
                            if (data != null) {
                                var fecha = FormatDate(data);
                                return fecha;
                            } else {
                                return "";
                            }
                        }
                },
                { "data": "Commodity" },
                { "data": "PuertoOrigen" },
                { "data": "PuertoDestino" },
                { "data": "Setpoint" },
                { "data": "Temperatura" },
                { "data": "IdServicio" },
                { "data": "Contenedor" },
                {
                    "data": "EstadoServicio",
                    "render":
                          function (data, type, row, meta) {
                              if (data == "ON SERVICE TRIP" || data == "NOT RECOVERED" || data == "RECOVERED") {
                                  return "ON SERVICE TRIP";
                              } else {
                                  return data;
                              }
                          }
                },
                { "data": "MovContenedor",
                    "render":
                    function( data, type, row, meta){
                        if(data =="MSH"){
                            return "DEPOSIT OUTPUT";
                        }else if(data =="ECY"){
                            return "TERMINAL INPUT";
                        }else{
                            return "";
                        }
                    } 
                },
                { "data": "Alerta" },
            ],
            columnDefs: [
                {
                    "targets": [20],
                    "visible": false,
                }
            ]
        });

        $(table.table().container()).on('keyup', 'thead input', function () {
            table
                .column($(this).data('index'))
                .search(this.value)
                .draw();
        });
    });

    function FormatDate(data) {
        var dateString = data.substr(6);
        var currentTime = new Date(parseInt(dateString));
        var month = currentTime.getMonth() + 1;
        var day = currentTime.getDate();
        var year = currentTime.getFullYear();

        if (month < 10) {
            month = "0" + month;
        } else {
            month;
        }

        if (day < 10) {
            day = "0" + day;
        } else {
            day;
        }

        var date = day + "-" + month + "-" + year;
        return date;
    }

</script>