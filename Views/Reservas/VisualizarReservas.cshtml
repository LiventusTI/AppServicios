
@{
    ViewBag.Title = "VisualizarReservas";
    Layout = "~/Views/MasterPage.cshtml";
    int PerfilInterior = Convert.ToInt32(Session["PerfilInterior"]);
    string Usuario = Session["User"].ToString().ToUpper();
}

<div class="col-sm-12">
    <div class="x_panel">
        <div class="x_title">
            <h2 class="tr" key="gestionreservas">Gestión reserva servicios</h2>
            <div class="clearfix"></div>
        </div>
        <div class="x_content">
            <div class="x_panel">
                <div class="x_title">
                    <h2 class="tr" key="filtrofechas">Filtro de Fechas</h2>
                    <div class="clearfix"></div>
                </div>
                <div class="row">
                    <div class="col-lg-10">
                        <form class="form-inline">
                            <div class="form-group">
                                <select class="selectpicker form-control"  data-live-search="true" id="Tipo_busqueda">
                                    <option selected value="0">FILTER BY ...</option>
                                    <option value="1">BOOKING REGISTRATION DATE</option>
                                    <option value="2">START DATE STACKING</option>
                                    <option value="3">FINAL DATE STACKING</option>
                                    <option value="4">ETD</option>
                                    <option value="5">ETA</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="Fecha_inicio" class="control-label tr" key="fechainicio">Fecha Inicio</label>
                                <input type="text" class="form-control" id="Fecha_inicio" />
                            </div>
                            <div class="form-group">
                                <label for="Fecha_termino" class="control-label tr" key="entre">Entre</label>
                                <input type="text" class="form-control" id="Fecha_termino" />
                            </div>
                        </form>
                    </div>
                    <div class="col-lg-2">
                        <button class="btn btn-primary tr" key="filtrar" id="FiltroFechas">Filtrar</button>
                        <button class="btn btn-warning tr" key="limpiar" id="Limpiar">Limpiar</button>
                    </div>
                </div>
            </div>
            <div class="x_panel">
                <table id="Tb_Reservas" class="table table-striped table-bordered display nowrap">
                    <thead>
                        <tr>
                            <th class="tr" key="idreserva">ID RESERVA</th>
                            <th>BOOKING</th>
                            <th class="tr" key="navierasolicitud">NAVIERA</th>   
                            <th class="tr" key="navereserva">NAVE</th>
                            <th class="tr" key="viajereserva">VIAJE</th>
                            <th class="tr" key="exportadorreserva">EXPORTADOR</th>
                            <th class="tr" key="commodityreserva">COMMODITY</th>
                            <th class="tr" key="commodityreserva">COMMODITY A PROGRAMAR</th>
                            <th class="tr" key="setpointreserva">SETPOINT</th>
                            <th class="tr" key="puertoorigenreserva">PUERTO EMBARQUE</th>
                            <th class="tr" key="puertodestinoeserva">PUERTO DESTINO</th>
                            <th>FREIGHTFORWARDER</th>
                            <th class="tr" key="consignatarioreserva">CONSIGNATARIO</th>
                            <th class="tr" key="iniciostackingreserva">INICIO STACKING</th>
                            <th class="tr" key="terminostackingreserva">TERMINO STACKING</th>
                            <th>DEADLINE</th>
                            <th>ETD</th>
                            <th>ETA</th>
                            <th class="tr" key="fecharegistroreserva">FECHA REGISTRO RESERVA</th>
                            <th class="tr" key="semanaregistroreserva">SEMANA REGISTRO RESERVA</th>
                            <th class="tr" key="cantidadservicioreserva">CANTIDAD SERVICIOS</th>
                            <th class="tr" key="estadotabla">ESTADO</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th class="tr" key="idreserva">ID RESERVA</th>
                            <th>BOOKING</th>
                            <th class="tr" key="navierasolicitud">NAVIERA</th>
                            <th class="tr" key="navereserva">NAVE</th>
                            <th class="tr" key="viajereserva">VIAJE</th>
                            <th class="tr" key="exportadorreserva">EXPORTADOR</th>
                            <th class="tr" key="commodityreserva">COMMODITY</th>
                            <th class="tr" key="commodityreserva">COMMODITY A PROGRAMAR</th>
                            <th class="tr" key="setpointreserva">SETPOINT</th>
                            <th class="tr" key="puertoorigenreserva">PUERTO EMBARQUE</th>
                            <th class="tr" key="puertodestinoeserva">PUERTO DESTINO</th>
                            <th>FREIGHTFORWARDER</th>
                            <th class="tr" key="consignatarioreserva">CONSIGNATARIO</th>
                            <th class="tr" key="iniciostackingreserva">INICIO STACKING</th>
                            <th class="tr" key="terminostackingreserva">TERMINO STACKING</th>
                            <th>DEADLINE</th>
                            <th>ETD</th>
                            <th>ETA</th>
                            <th class="tr" key="semanaregistroreserva">FECHA REGISTRO RESERVA</th>
                            <th class="tr" key="fecharegistroreserva">SEMANA REGISTRO RESERVA</th>
                            <th class="tr" key="cantidadservicioreserva">TOTAL :</th>
                            <th class="tr" key="estadotabla">ESTADO</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <div class="row">
                <div class="col-lg-4">
                    <form class="form-inline">
                        <div class="form-group">
                            <label for="IdReserva">ID RESERVA</label>
                            <input type="text" class="form-control" id="IdReserva" disabled="disabled" style="text-align:center; text-align-last:center;" />
                        </div>

                    </form>
                </div>
            </div>
            <div class="divider"></div>
            <div class="row">
                <div class="col-lg-11 col-lg-offset-1">
                    <input type="text" class="form-control" id="Estado" disabled="disabled" style="text-align:center; text-align-last:center; display:none;" />
                    <button type="button" class="btn btn-primary tr" id="Editar" key="botoneditarreserva" style="margin-bottom: 0px;">Editar Reserva</button>
                    <button type="button" class="btn btn-warning tr" id="Modificaciones" key="botonhistoricomodificaciones" style="margin-bottom: 0px;">Historial Modificaciones</button>
                    <button type="button" class="btn btn-info tr" id="Detalle" key="botonresumenreserva" style="margin-bottom: 0px;">Ver Resumen de Reserva</button>
                    <button type="button" class="btn btn-success tr" id="Agregar" key="botonagregarresultados" style="margin-bottom: 0px;">Gestionar / Agregar Servicios</button>
                    <button type="button" class="btn btn-danger cancelar tr" id="Cancelar" key="botoncancelarreserva" style="margin-bottom: 0px;">Cancelar Reserva</button>
                </div>
            </div>
        </div>
    </div>

    <!--Modal para visualizar detalle de los servicios asociados a la reserva-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"  style="margin-left:80px; margin-right:10px;">
        <div class="modal-dialog" role="document" style="width:100%;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title tr" id="myModalLabel" key="titulodetallereserva">Detalles Reserva</h4>
                </div>
                <div class="modal-body">
                    <table id="Tb_detalle" class="table table-striped table-bordered display nowrap" width="100%">
                        <thead>
                            <tr>
                                <th>BOOKING</th>
                                <th class="tr" key="reservadosdetallereserva">RESERVADOS</th>
                                <th class="tr" key="totalserviciosdetallereserva">PRESTADOS</th>
                                <th class="tr" key="totalserviciosdetallereserva">POR PRESTAR</th>
                                <th class="tr" key="enviajedetallereserva">EN VIAJE</th>
                                <th class="tr" key="canceladosdetallereserva">CANCELADOS</th>
                                <th class="tr" key="norecuperadosdetallereserva">NO RECUPERADOS</th>
                                <th class="tr" key="recuperadosdetallereserva">RECUPERADOS</th>
                                <th class="tr" key="labdetallereserva">RETORNADOS A LAB</th>
                            </tr> 
                        </thead>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal para visualizar detalle de la reserva de leaktest-->
    <!--Modal para editar datos de la reserva de servicio-->
    <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="margin-left:80px; margin-right:10px;">
        <div class="modal-dialog" role="document" style="width:100%;">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm-12 col-md-12 col-lg-12">
                            <div class="col-lg-6 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label class="control-label">
                                        Booking (*)
                                    </label>
                                    <div>
                                        <input type="text" id="Booking" class="form-control" readonly="readonly">
                                    </div>
                                    <div id="ObligatorioBooking" style="display:none;">
                                        <span style="color:red;" class="form-control">Campo Obligatorio</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Naviera" class="control-label tr" key="naviera">Naviera (*)</label>
                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="Naviera" name="Naviera">
                                            <option value="0" selected class="tr" key="selectnaviera">Seleccione Naviera</option>
                                        </select>
                                    </div>
                                    <div id="ObligatorioNaviera" style="display:none;">
                                        <span style="color:red;" class="form-control">Campo Obligatorio</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Nave" class="control-label tr" key="nave">Nave</label>
                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="Naves" name="Naves">
                                            <option value="0" selected class="tr" key="selectnave">Seleccione Nave</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Pais_exportador" class="control-label tr" key="paisexportador">País Exportador</label>
                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="Pais_exportador" name="Pais_exportador"></select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Exportador" class="control-label tr" key="exportador">Exportador (*) </label>
                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="Exportador" name="Exportador">
                                            <option value="0" selected class="tr" key="selectexportador">Seleccione Exportador</option>
                                        </select>
                                    </div>
                                    <div id="ObligatorioExportador" style="display:none;">
                                        <span style="color:red;" class="form-control">Campo Obligatorio</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="FreightForwarder" class="control-label">Freight Forwarder</label>

                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="FreightForwarder" name="FreightForwarder">
                                            <option value="0" selected class="tr" key="selectfreightforwarder">Seleccione FreightForwarder</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Consignatario" class="control-label tr" key="consignatario">Consignatario</label>
                                    <div>
                                        <input type="text" id="Consignatario" class="form-control" onkeyup="this.value = this.value.toUpperCase();">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Commodity" class="control-label">Commodity (*)</label>
                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="Commodity" name="Commodity">
                                            <option value="0" selected class="tr" key="selectcommodity">Seleccione Commodity</option>
                                        </select>
                                    </div>
                                    <div id="ObligatorioCommodity" style="display:none;">
                                        <span style="color:red;" class="form-control">Campo Obligatorio</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Setpoint" class="control-label">Set Point (*)</label>
                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="Setpoint" name="Setpoint">
                                            <option value="0" selected class="tr" key="selectsetpoint">Seleccione Set Point</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Inicio_stacking" class="control-label tr" key="iniciostacking">Inicio Stacking</label>
                                    <div>
                                        <input type="text" id="Inicio_stacking" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Termino_stacking" class="control-label tr" key="terminostacking">Termino Stacking</label>
                                    <div>
                                        <input type="text" id="Termino_stacking" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-12">
                                <div class="form-group">
                                    <label for="Viaje" class="control-label tr" key="viaje">Viaje</label>
                                    <div>
                                        <input type="text" id="Viaje" class="form-control" onkeyup="this.value = this.value.toUpperCase();">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Pais_origen" class="control-label tr" key="paispuertoorigen">País Puerto Embarque</label>
                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="Pais_origen" name="Pais_origen">
                                            <option value="0" selected class="tr" key="selectpais">Seleccione País</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Ciudad_origen" class="control-label tr" key="ciudadpuertoorigen">Ciudad Puerto Embarque</label>
                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="Ciudad_origen" name="Ciudad_origen">
                                            <option value="0" selected class="tr" key="selectciudad">Seleccione Ciudad</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Puerto_origen" class="control-label tr" key="puertoorigen">Puerto Embarque (*)</label>
                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="Puerto_origen" name="Puerto_origen">
                                            <option value="0" selected class="tr" key="selectpuerto">Seleccione Puerto</option>
                                        </select>
                                    </div>
                                    <div id="ObligatorioPuerto_origen" style="display:none;">
                                        <span style="color:red;" class="form-control">Campo Obligatorio</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Pais_destino" class="control-label tr" key="paispuertodestino">País Puerto Destino</label>
                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="Pais_destino" name="Pais_destino">
                                            <option value="0" selected class="tr" key="selectpais">Seleccione País</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Ciudad_destino" class="control-label tr" key="ciudadpuertodestino">Ciudad Puerto Destino</label>
                                    <div>
                                        <select class="selectpicker form-control" data-live-search="true" id="Ciudad_destino" name="Ciudad_destino">
                                            <option value="0" selected class="tr" key="selectciudad">Seleccione Ciudad</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Puerto_destino" class="control-label tr" key="puertodestino">Puerto Destino (*)</label>
                                    <div>
                                        <select  class="selectpicker form-control" data-live-search="true" id="Puerto_destino" name="Puerto_destino">
                                            <option value="0" selected class="tr" key="selectpuerto">Seleccione Puerto</option>
                                        </select>
                                    </div>
                                    <div id="ObligatorioPuerto_destino" style="display:none;">
                                        <span style="color:red;" class="form-control">Campo Obligatorio</span>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="control-label">ETD (*)</label>
                                    <div>
                                        <input type="text" id="Etd" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label">ETA (*)</label>
                                    <div>
                                        <input type="text" id="Eta" class="form-control" autocomplete="off">
                                    </div>
                                    <div id="ObligatorioEta" style="display:none;">
                                        <span style="color:red;" class="form-control">Campo Obligatorio</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="Cantidad_servicios" class="control-label tr" key="cantidadservicios">Cantidad Servicios (*)</label>
                                    <div>
                                        <input type="text" id="Cantidad_servicios" class="form-control">
                                        <div id="CantidadServ" style="display:none;">
                                            <span style="color:red;" class="form-control">Campo Debe ser Mayor a 0</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="TemperaturaEditar" class="control-label tr" key="Temperatura">Temperatura (*)</label>
                                    <div>
                                        <input type="number" step="0.1" id="TemperaturaEditar" class="form-control" autocomplete="off">
                                    </div>
                                </div>
                                <br />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-success tr" id="EditarReservaServicio" key="botoneditarreserva">Editar Reserva</button>
                    <button type="button" class="btn btn-danger tr" data-dismiss="modal" key="botoncancelareditarreserva">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal para editar datos de la reserva de leaktest-->
    <!--Modal para visualizar detalle de los servicios asociados a la reserva-->
    <div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="margin-left:80px; margin-right:10px;">
        <div class="modal-dialog" role="document" style="width:100%;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Historial Modificaciones</h4>
                </div>
                <div class="modal-body">
                    <table id="Tb_Operaciones" class="table table-striped table-bordered" width="100%">
                        <thead>
                            <tr>
                                <th class="tr" key="operaciontablareserva">ID OPERACION</th>
                                <th class="tr" key="usuariotablareserva">USUARIO</th>
                                <th class="tr" key="fechatablareserva">FECHA</th>
                                <th class="tr" key="observaciontablareserva">DESCRIPCION</th>
                                <th>PUERTO DESTINO</th>
                                <th>PUERTO ORIGEN</th>
                                <th>SETPOINT</th>
                                <th>COMMODITY</th>
                                <th>FREIGHTFORWARDER</th>
                                <th>BOOKING</th>
                                <th>VIAJE</th>
                                <th>CONSIGNATARIO</th>
                                <th>CANTIDAD SERVICIOS</th>
                                <th>ETA</th>
                                <th>NAVE</th>
                                <th>ETD</th>
                                <th>FECHA INI STACKING</th>
                                <th>FECHA FIN STACKING</th>
                                <th>EXPORTADOR</th>
                                <th>ESTADO</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th class="tr" key="operaciontablareserva">ID OPERACION</th>
                                <th class="tr" key="usuariotablareserva">USUARIO</th>
                                <th class="tr" key="fechatablareserva">FECHA</th>
                                <th class="tr" key="observaciontablareserva">DESCRIPCION</th>
                                <th>PUERTO DESTINO</th>
                                <th>PUERTO ORIGEN</th>
                                <th>SETPOINT</th>
                                <th>COMMODITY</th>
                                <th>FREIGHTFORWARDER</th>
                                <th>BOOKING</th>
                                <th>VIAJE</th>
                                <th>CONSIGNATARIO</th>
                                <th>CANTIDAD SERVICIOS</th>
                                <th>ETA</th>
                                <th>NAVE</th>
                                <th>ETD</th>
                                <th>FECHA INI STACKING</th>
                                <th>FECHA FIN STACKING</th>
                                <th>EXPORTADOR</th>
                                <th>ESTADO</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger tr" data-dismiss="modal" key="botoncerrarmodificaciones">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal para visualizar detalle de la reserva de leaktest-->


</div>

<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" id="Detalles" style="display:none;"></button>
<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal2" id="EditarReserva" style="display:none;"></button>
<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal3" id="ModificacionesReservaModal" style="display:none;"></button>


<script src="~/build/js/Perfiles.js"></script>
<script src="~/build/js/PerfilGestionReserva.js"></script>
 <script type="text/javascript">

     var lenguaje = document.cookie;

     $(function () {
         $("#Inicio_stacking, #Termino_stacking, #Eta, #Etd, #Fecha_inicio, #Fecha_termino").datepicker({
             dateFormat: "dd-mm-yy",
             firstDay: 1,
             dayNamesMin: ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"],
             dayNamesShort: ["Dom", "Lun", "Mar", "Mie", "Jue", "Vie", "Sab"],
             monthNames:
                 ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio",
                 "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
             monthNamesShort:
                 ["Ene", "Feb", "Mar", "Abr", "May", "Jun",
                 "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
             showWeek: true
         });
     });

     $(document).ready(function () {

         $('#Tb_Reservas tfoot th').each(function (i) {
             var title = $('#Tb_Reservas thead th').eq($(this).index()).text();
             if (title != "CANTIDAD SERVICIOS") {
                 if (lenguaje == "es" && title) {
                     $(this).html('<input class="form-control ' +title+ '" type="text" placeholder="FILTRAR"/>');
                 } else {

                     $(this).html('<input class="form-control ' + title + '" type="text" placeholder="FILTER" />');
                 }
             }
         });

         $.ajax({
             type: "POST",
             url: '@Url.Action("GetReservas", "Reservas")',
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 for (var i = 0 ; i < cuenta ; i++) {
                     var fecharegistro = formatDate(json[i].FechaRegistro);

                     if (json[i].FechaIniStacking == null)
                     {
                         var fechainistacking = "";
                     } else
                     {
                         var fechainistacking = formatDate(json[i].FechaIniStacking);
                     }

                     if (json[i].FechaFinStacking == null) {
                         var fechafinstacking = "";
                     } else {
                         var fechafinstacking = formatDate(json[i].FechaFinStacking);
                     }

                     if (json[i].Etd == null) {
                         var etd = "";
                     } else {
                         var etd = formatDate(json[i].Etd);
                     }

                     var deadline = "";
                     var estado = "";
                     if (json[i].Estado == 0) {
                         estado = "INGRESSED BOOKING";
                     } else if (json[i].Estado == 1) {
                         estado = "CANCELLED BOOKING";
                     } else if (json[i].Estado == 2) {
                         estado = "FINISHED BOOKING";
                     }
                     var semana = new Date(json[i].FechaRegistro).format('W');
                     //semana = semana - 1;

                     var eta = formatDate(json[i].Eta);
                     if(@PerfilInterior == 16){
                         var user = "@Usuario";
                         if(json[i].Naviera == user ){
                             data.push([json[i].Id, json[i].Booking.toUpperCase(), json[i].Naviera, json[i].Nave,
                                 json[i].Viaje, json[i].Exportador, json[i].Commodity, json[i].CommodityTecnica, json[i].Setpoint,
                                 json[i].PuertoOrigen, json[i].PuertoDestino, json[i].FreightForwarder, json[i].Consignatario.toUpperCase(),
                                 fechainistacking, fechafinstacking, deadline, etd, eta, fecharegistro,semana, json[i].CantidadServicios,estado]);
                         }
                     }else{
                         data.push([json[i].Id, json[i].Booking.toUpperCase(), json[i].Naviera, json[i].Nave,
                            json[i].Viaje, json[i].Exportador, json[i].Commodity, json[i].CommodityTecnica, json[i].Setpoint,
                            json[i].PuertoOrigen, json[i].PuertoDestino, json[i].FreightForwarder, json[i].Consignatario.toUpperCase(),
                            fechainistacking, fechafinstacking, deadline, etd, eta, fecharegistro,semana, json[i].CantidadServicios,estado]);
                     }

                 }

                 if (lenguaje == "es") {
                     var table = $('#Tb_Reservas').DataTable({
                         data: data,
                         "language": {
                             "lengthMenu": "Mostrar _MENU_ Resultados por pagina",
                             "zeroRecords": "No hay Resultados para mostrar",
                             "info": "Mostrando pagina _PAGE_ de _PAGES_ paginas",
                             "infoEmpty": "No hay Resultados disponibles",
                             "search": "Buscar: ",
                             "paginate": {
                                 "first": "Primera",
                                 "last": "Última",
                                 "next": "Siguiente",
                                 "previous": "Anterior"
                             }
                         },
                         dom: 'Bfrtip',
                         buttons: [
                             'copy', 'csv', 'excel'
                         ],
                         scrollX: true,
                         "order": [[14, "asc"]],
                         "rowCallback": function (row, data, index) {
                             var validar = 0;
                             if (data[21] == "INGRESSED BOOKING") {
                                 validar = validarfechas(data[14]);
                                 if (validar == 0) {
                                     $('td', row).css("background-color", "rgba(255, 0, 0, 0.4)");
                                 }
                             }

                         },
                         "footerCallback": function (row, data, start, end, display) {
                             var api = this.api(), data;

                             // Remove the formatting to get integer data for summation
                             var intVal = function (i) {
                                 return typeof i === 'string' ?
                                     i.replace(/[\$,]/g, '') * 1 :
                                     typeof i === 'number' ?
                                     i : 0;
                             };

                             // Total over all pages
                             total = api
                                 .column(20)
                                 .data()
                                 .reduce(function (a, b) {
                                     return intVal(a) + intVal(b);
                                 }, 0);

                             // Total over this page
                             pageTotal = api
                                 .column(20, { page: 'current' })
                                 .data()
                                 .reduce(function (a, b) {
                                     return intVal(a) + intVal(b);
                                 }, 0);

                             // Update footer
                             $(api.column(20).footer()).html(
                                 'Total: ' + pageTotal + ' (de ' + total + ' Servicios)'
                             );
                         }
                     });
                 } else {

                     var table = $('#Tb_Reservas').DataTable({
                         data: data,
                         dom: 'Bfrtip',
                         buttons: [
                             'copy', 'csv', 'excel'
                         ],
                         scrollX: true,
                         "order": [[13, "asc"]],
                         "order": [[14, "asc"]],
                         "rowCallback": function (row, data, index) {
                             var validar = 0;
                             if (data[21] == "INGRESSED BOOKING") {
                                 validar = validarfechas(data[14]);
                                 if (validar == 0) {
                                     $('td', row).css("background-color", "rgba(255, 0, 0, 0.4)");
                                 }
                             }

                         },
                         "footerCallback": function (row, data, start, end, display) {
                             var api = this.api(), data;

                             // Remove the formatting to get integer data for summation
                             var intVal = function (i) {
                                 return typeof i === 'string' ?
                                     i.replace(/[\$,]/g, '') * 1 :
                                     typeof i === 'number' ?
                                     i : 0;
                             };

                             // Total over all pages
                             total = api
                                 .column(20)
                                 .data()
                                 .reduce(function (a, b) {
                                     return intVal(a) + intVal(b);
                                 }, 0);

                             // Total over this page
                             pageTotal = api
                                 .column(20, { page: 'current' })
                                 .data()
                                 .reduce(function (a, b) {
                                     return intVal(a) + intVal(b);
                                 }, 0);

                             // Update footer
                             $(api.column(20).footer()).html(
                                'Total: ' + pageTotal + ' (de ' + total + ' Servicios)'
                             );
                         }
                     });
                 }

                 table.columns().every(function () {

                     if(@PerfilInterior == 16){
                         table.columns([7,15]).visible(false);
                         var user = "@Usuario";
                         var caracteres = user.split("");
                         var string = "";
                         for(var i = 0; i < caracteres.length; i++){
                             var code = caracteres[i].charCodeAt(0);
                             var e = $.Event("keyup", {keyCode: code});
                             string = string + caracteres[i];
                             $('.NAVIERA').focus();
                             $('.NAVIERA').trigger(e);
                             $(".NAVIERA").val(string);
                         }
                         $(".NAVIERA").attr('readonly', true);
                     }

                     var that = this;
                     $('input', this.footer()).on('keyup change', function () {
                         if (that.search() !== this.value) {
                             that
                                 .search(this.value)
                                 .draw();
                         }
                     });
                 });

                 $('#Tb_Reservas tbody').on('click', 'tr', function () {
                     //if (cuenta != 0) {
                         if ($(this).hasClass('selected')) {
                             $("#IdReserva").val(this.children[0].innerText);
                             $("#Estado").val(this.children[20].innerText);
                             $("#Booking").val(this.children[1].innerText);
                             $(this).removeClass('selected');
                         }else {
                             table.$('tr.selected').removeClass('selected');
                             $("#IdReserva").val(this.children[0].innerText);
                             $("#Estado").val(this.children[20].innerText);
                             $("#Booking").val(this.children[1].innerText);
                             $(this).addClass('selected');
                         }
                     //}
                 });
             },
         });



         //OBTENER NAVES
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetNavesActivas", "Nave")',
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 $('#Naves').empty();
                 for (var i = 0; i < cuenta; i++) {
                     optionsAsString += "<option value='" + json[i].IdNave + "' >" + json[i].NombreNave + "</option>";
                 }
                 $('#Naves').append(optionsAsString);
                 $('#Naves').selectpicker('refresh');
             },
         });
         //OBTENER NAVES

         //OBTENER NAVIERAS
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetNavierasActivas", "Naviera")',
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 $('#Naviera').empty();
                 for (var i = 0; i < cuenta; i++) {
                     optionsAsString += "<option value='" + json[i].Id + "' >" + json[i].Nombre + "</option>";
                 }
                 $('#Naviera').append(optionsAsString);
                 $('#Naviera').selectpicker('refresh');
             },
         });
         //OBTENER NAVIERAS

         //OBTENER EXPORTADORES
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetExportadorActivos", "Exportador")',
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 $('#Exportador').empty();
                 for (var i = 0; i < cuenta; i++) {
                     optionsAsString += "<option value='" + json[i].Id_Exportador + "'>" + json[i].NombreExportador + " - " + json[i].NombrePais + "</option>";
                 }
                 $('#Exportador').append(optionsAsString);
                 $('#Exportador').selectpicker('refresh');
             },
         });
         //OBTENER EXPORTADORES

         //OBTENER PUERTOS DESTINO
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetPuertos", "Puertos")',
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 $('#Puerto_destino').empty();
                 $('#Puerto_origen').empty();
                 for (var i = 0; i < cuenta; i++) {
                     optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + " - " + json[i].NombreCiudad + "</option>";
                 }
                 $('#Puerto_destino').append(optionsAsString);
                 $('#Puerto_destino').selectpicker('refresh');
                 $('#Puerto_origen').append(optionsAsString);
                 $('#Puerto_origen').selectpicker('refresh');
             },
         });
         //OBTENER PUERTOS DESTINO

         //OBTENER PAISES
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetPaisesActivos", "Paises")',
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 $('#Pais_exportador').empty();
                 $('#Pais_origen').empty();
                 $('#Pais_destino').empty();
                 for (var i = 0; i < cuenta; i++) {
                     optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + "</option>";
                 }
                 $('#Pais_exportador, #Pais_origen, #Pais_destino').append(optionsAsString);
                 $('#Pais_exportador, #Pais_origen, #Pais_destino').selectpicker('refresh');
             },
         });
         //OBTENER PAISES

         //OBTENER CIUDADES
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetCiudadesActivas", "Ciudad")',
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 $('#Ciudad_origen').empty();
                 $('#Ciudad_destino').empty();
                 for (var i = 0; i < cuenta; i++) {
                     optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + " - " + json[i].NombrePais + "</option>";
                 }
                 $('#Ciudad_origen').append(optionsAsString);
                 $('#Ciudad_origen').selectpicker('refresh');
                 $('#Ciudad_destino').append(optionsAsString);
                 $('#Ciudad_destino').selectpicker('refresh');
             },
         });
         //OBTENER CIUDADES

         //OBTENER SETPOINT
        $.ajax({
            type: "POST",
            url: '@Url.Action("GetSetpoint", "Setpoint")',
            success: function (response) {
                var data = [];
                var json = JSON.parse(response);
                var cuenta = json.length;
                var optionsAsString = "";
                $('#Setpoint').empty();
                for (var i = 0; i < cuenta; i++) {
                    optionsAsString += "<option value='" + json[i].IdSetpoint + "'>" + json[i].CO2 + "% CO2, " + json[i].O2 + "% O2" + "</option>";
                }
                $('#Setpoint').append(optionsAsString);
                $('#Setpoint').selectpicker('refresh');
            },
        });
         //OBTENER SETPOINT

         //OBTENER FreightForwarder
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetFreightForwarderActivos", "FreightForwarder")',
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 $('#FreightForwarder').empty();
                 for (var i = 0; i < cuenta; i++) {
                     optionsAsString += "<option value='" + json[i].Id_FreightForwarder + "'>" + json[i].NombreFreightForwarder + "</option>";
                 }
                 $('#FreightForwarder').append(optionsAsString);
                 $('#FreightForwarder').selectpicker('refresh');
             },
         });
         //OBTENER FreightForwarder

         //OBTENER COMMODITY
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetCommodityActivo", "Commoditie")',
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 $('#Commodity').empty();
                 for (var i = 0; i < cuenta; i++) {
                     optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + "</option>";
                 }
                 $('#Commodity').append(optionsAsString);
                 $('#Commodity').selectpicker('refresh');
             },
         });
         //OBTENER COMMODITY
     });

     function formatDate(date) {
         var fecha = date.substring(0, 10);
         var ano = date.substring(0, 4);
         var mes = date.substring(5, 7);
         var dia = date.substring(8, 10);
         return dia + "-" + mes + "-" + ano;
     }

     $("#Agregar").click(function () {
         //Agregar servicios a reserva
         if ($("#IdReserva").val() != "") {
             $.ajax({
                 type: "POST",
                 url: '@Url.Action("GetEstadoReserva", "Reservas")',
                 data: { IdReserva: $("#IdReserva").val() },
                 success: function (response) {
                     if (response != 1) {
                         var url = '@Url.Action("ConsultarServicios", "Reservas")?Id=' + $("#IdReserva").val();
                         window.location.href = url;
                     } else {
                         swal('Ups!', '<span class="alerta" key="erroragregarservicios">No pueden agregar servicios a una reserva cancelada</span>', 'error');
                     }
                 },
             });

         } else{
             swal('Ups!', '<span class="alerta" key="erroragregarservicios">Debes seleccionar una reserva</span>', 'error');
         }
     });

     $("#FiltroFechas").click(function () {
         var table = $('#Tb_Reservas').DataTable();
         table.destroy();

         if ($("#Tipo_busqueda").val() != "0" && $("#Fecha_inicio").val() != "" && $("#Fecha_termino").val() != "") {
             var fechainicio = new Date($('#Fecha_inicio').val()).getTime();
             var fechatermino = new Date($('#Fecha_termino').val()).getTime();
             if (fechatermino < fechainicio) {
                 swal('Ups!', 'La fecha final no puede ser menor a la fecha inicial.', 'warning');
                 return false;
             }

             $.ajax({
                 type: "POST",
                 url: '@Url.Action("FiltroPorFechas", "Reservas")',
                 data: { Tipo: $("#Tipo_busqueda").val(), FechaIni: $("#Fecha_inicio").val(), FechaFin: $("#Fecha_termino").val() },
                 success: function (response) {
                     var data = [];
                     var json = JSON.parse(response);
                     var cuenta = json.length;
                     for (var i = 0 ; i < cuenta ; i++) {
                         var fecharegistro = formatDate(json[i].FechaRegistro);
                         var estado = "";
                         if (json[i].FechaIniStacking == null) {
                             var fechainistacking = "";
                         } else {
                             var fechainistacking = formatDate(json[i].FechaIniStacking);
                         }

                         if (json[i].FechaIniStacking == null) {
                             var fechafinstacking = "";
                         } else {
                             var fechafinstacking = formatDate(json[i].FechaFinStacking);
                         }

                         if (json[i].Etd == null) {
                             var etd = "";
                         } else {
                             var etd = formatDate(json[i].Etd);
                         }

                         var deadline = "";


                         if (json[i].Estado == 0) {
                             estado = "INGRESSED BOOKING";
                         } else if (json[i].Estado == 1) {
                             estado = "CANCELLED BOOKING";
                         } else if (json[i].Estado == 2) {
                             estado = "FINISHED BOOKING";
                         }

                         var semana = new Date(json[i].FechaRegistro).format('W');
                         semana = semana - 1;

                         var eta = formatDate(json[i].Eta);
                         if(@PerfilInterior == 16){
                             var user = "@Usuario";
                             if(json[i].Naviera == user ){
                                 data.push([json[i].Id, json[i].Booking.toUpperCase(), json[i].Naviera, json[i].Nave,
                                     json[i].Viaje, json[i].Exportador, json[i].Commodity, json[i].CommodityTecnica, json[i].Setpoint,
                                     json[i].PuertoOrigen, json[i].PuertoDestino, json[i].FreightForwarder, json[i].Consignatario.toUpperCase(),
                                     fechainistacking, fechafinstacking, deadline, etd, eta, fecharegistro,semana, json[i].CantidadServicios,estado]);
                             }
                         }else{
                             data.push([json[i].Id, json[i].Booking.toUpperCase(), json[i].Naviera, json[i].Nave,
                                json[i].Viaje, json[i].Exportador, json[i].Commodity, json[i].CommodityTecnica, json[i].Setpoint,
                                json[i].PuertoOrigen, json[i].PuertoDestino, json[i].FreightForwarder, json[i].Consignatario.toUpperCase(),
                                fechainistacking, fechafinstacking, deadline, etd, eta, fecharegistro,semana, json[i].CantidadServicios,estado]);
                         }
                     }

                     if (lenguaje == "es") {
                         var table = $('#Tb_Reservas').DataTable({
                             data: data,
                             "language": {
                                 "lengthMenu": "Mostrar _MENU_ Resultados por pagina",
                                 "zeroRecords": "No hay Resultados para mostrar",
                                 "info": "Mostrando pagina _PAGE_ de _PAGES_ paginas",
                                 "infoEmpty": "No hay Resultados disponibles",
                                 "search": "Buscar: ",
                                 "paginate": {
                                     "first": "Primera",
                                     "last": "Última",
                                     "next": "Siguiente",
                                     "previous": "Anterior"
                                 }
                             },
                             dom: 'Bfrtip',
                             buttons: [
                                 'copy', 'csv', 'excel'
                             ],
                             scrollX: true,
                             "order": [[14, "asc"]],
                             "rowCallback": function (row, data, index) {
                                 var validar = 0;
                                 if (data[21] == "INGRESSED BOOKING") {
                                     validar = validarfechas(data[14]);
                                     if (validar == 0) {
                                         $('td', row).css("background-color", "rgba(255, 0, 0, 0.4)");
                                     }
                                 }

                             },
                             "footerCallback": function (row, data, start, end, display) {
                                 var api = this.api(), data;

                                 // Remove the formatting to get integer data for summation
                                 var intVal = function (i) {
                                     return typeof i === 'string' ?
                                         i.replace(/[\$,]/g, '') * 1 :
                                         typeof i === 'number' ?
                                         i : 0;
                                 };

                                 // Total over all pages
                                 total = api
                                     .column(29)
                                     .data()
                                     .reduce(function (a, b) {
                                         return intVal(a) + intVal(b);
                                     }, 0);

                                 // Total over this page
                                 pageTotal = api
                                     .column(20, { page: 'current' })
                                     .data()
                                     .reduce(function (a, b) {
                                         return intVal(a) + intVal(b);
                                     }, 0);

                                 // Update footer
                                 $(api.column(20).footer()).html(
                                     pageTotal + ' (' + total + ' Servicios)'
                                 );
                             }
                         });
                     } else {
                         var table = $('#Tb_Reservas').DataTable({
                             data: data,
                             dom: 'Bfrtip',
                             buttons: [
                                 'copy', 'csv', 'excel'
                             ],
                             scrollX: true,
                             "order": [[14, "asc"]],
                             "rowCallback": function (row, data, index) {
                                 var validar = 0;
                                 if (data[21] == "INGRESSED BOOKING") {
                                     validar = validarfechas(data[14]);
                                     if (validar == 0) {
                                         $('td', row).css("background-color", "rgba(255, 0, 0, 0.4)");
                                     }
                                 }

                             },
                             "footerCallback": function (row, data, start, end, display) {
                                 var api = this.api(), data;

                                 // Remove the formatting to get integer data for summation
                                 var intVal = function (i) {
                                     return typeof i === 'string' ?
                                         i.replace(/[\$,]/g, '') * 1 :
                                         typeof i === 'number' ?
                                         i : 0;
                                 };

                                 // Total over all pages
                                 total = api
                                     .column(20)
                                     .data()
                                     .reduce(function (a, b) {
                                         return intVal(a) + intVal(b);
                                     }, 0);

                                 // Total over this page
                                 pageTotal = api
                                     .column(20, { page: 'current' })
                                     .data()
                                     .reduce(function (a, b) {
                                         return intVal(a) + intVal(b);
                                     }, 0);

                                 // Update footer
                                 $(api.column(20).footer()).html(
                                     pageTotal + ' (' + total + ' Servicios)'
                                 );
                             }
                         });
                     }

                     table.columns().every(function () {
                         if(@PerfilInterior == 16){
                             table.columns([7,15]).visible(false);
                             var user = "@Usuario";
                             var caracteres = user.split("");
                             var string = "";
                             for(var i = 0; i < caracteres.length; i++){
                                 var code = caracteres[i].charCodeAt(0);
                                 var e = $.Event("keyup", {keyCode: code});
                                 string = string + caracteres[i];
                                 $('.NAVIERA').focus();
                                 $('.NAVIERA').trigger(e);
                                 $(".NAVIERA").val(string);
                             }
                             $(".NAVIERA").attr('readonly', true);
                        }
                         var that = this;
                         $('input', this.footer()).on('keyup change', function () {
                             if (that.search() !== this.value) {
                                 that
                                     .search(this.value)
                                     .draw();
                             }
                         });
                     });

                     $('#Tb_Reservas tbody').on('click', 'tr', function () {
                         if (cuenta != 0) {
                             if ($(this).hasClass('selected')) {
                                 $("#IdReserva").val(this.children[0].innerText);
                                 $("#Estado").val(this.children[20].innerText);
                                 $("#Booking").val(this.children[1].innerText);
                                 $(this).removeClass('selected');
                             }
                             else {
                                 table.$('tr.selected').removeClass('selected');
                                 $("#IdReserva").val(this.children[0].innerText);
                                 $("#Estado").val(this.children[20].innerText);
                                 $("#Booking").val(this.children[1].innerText);
                                 $(this).addClass('selected');
                             }
                         }
                     });

                 },
             });
         } else {
             swal('Ups!', '<span>Debe seleccionar todos los campos para filtrar por fechas.</span>', 'error');
         }

     });

     //OBTENER EXPORTADORES A PARTIR DE PAIS SELECCIONADO
     $("#Pais_exportador").change(function () {
         if ($("#Pais_exportador").val() != "0") {
             $('#Exportador').empty();
             $.ajax({
                 type: "POST",
                 url: '@Url.Action("GetExportadorPais", "Exportador")',
                 data: { IdPais: $("#Pais_exportador").val() },
                 success: function (response) {
                     var data = [];
                     var json = JSON.parse(response);
                     var cuenta = json.length;
                     var optionsAsString = "";
                     optionsAsString += "<option value='0'>Seleccione Exportador</option>";
                     for (var i = 0; i < cuenta; i++) {
                         optionsAsString += "<option value='" + json[i].Id_Exportador + "'>" + json[i].NombreExportador + "</option>";
                     }
                     $('#Exportador').append(optionsAsString);
                     $('#Exportador').selectpicker('refresh');
                 },
             });
         } else {
             $.ajax({
                 type: "POST",
                 url: '@Url.Action("GetExportadorActivos", "Exportador")',
                 success: function (response) {
                     var data = [];
                     var json = JSON.parse(response);
                     var cuenta = json.length;
                     var optionsAsString = "";
                     optionsAsString += "<option value='0'>Seleccione un Exportador</option>";

                     for (var i = 0; i < cuenta; i++) {
                         optionsAsString += "<option value='" + json[i].Id_Exportador + "'>" + json[i].NombreExportador + "</option>";
                     }

                     $('#Exportador').append(optionsAsString);
                     $('#Exportador').selectpicker('refresh');
                 },
             });
         }
     });
     //OBTENER EXPORTADORES A PARTIR DE PAIS SELECCIONADO

     $("#Exportador").change(function () {
         if ($("#Exportador").val() != "0") {
             $.ajax({
                 type: "POST",
                 url: '@Url.Action("GetInfoExportador", "Exportador")',
                 data: { Exportador: $("#Exportador").val() },
                 success: function (response) {
                     var data = [];
                     var json = JSON.parse(response);
                     var cuenta = json.length;
                     if (cuenta != 0) {
                         $("#Exportador").val(json[0].IdExportador);
                         $("#Exportador").selectpicker('refresh');
                     }
                 },
             });
         }
     });

     //OBTENER CIUDADES A PARTIR DE PAIS SELECCIONADO
     $("#Pais_destino").change(function () {
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetCiudadesPais", "Ciudad")',
             data: { IdPais: $("#Pais_destino").val() },
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 var optionsAsString1 = "";
                 if (cuenta != 0) {
                     $('#Ciudad_destino').empty();
                     optionsAsString += "<option value='0'>Seleccione Ciudad</option>";
                     for (var i = 0; i < cuenta; i++) {
                         optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + " - " + json[i].NombrePais + "</option>";;
                     }
                     $('#Ciudad_destino').append(optionsAsString);
                     $('#Ciudad_destino').selectpicker('refresh');
                 } else {
                     //optionsAsString += "<option value='0'>Seleccione Ciudad</option>";
                     //$('#Ciudad_destino').empty();
                     //$('#Ciudad_destino').append(optionsAsString);
                     //$('#Ciudad_destino').prop('disabled', 'disabled');
                     //$('#Ciudad_destino').selectpicker('refresh');
                 }
             },
         });
     });
     //OBTENER CIUDADES A PARTIR DE PAIS SELECCIONADO

     //OBTENER PUERTOS DESTINO A PARTIR DE CIUDAD SELECCIONADO
     $("#Ciudad_destino").change(function () {
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetPuertosDestinoCiudad", "Puertos")',
             data: { IdCiudad: $("#Ciudad_destino").val() },
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 var optionsAsString1 = "";
                 if (cuenta != 0) {
                     $('#Puerto_destino').empty();
                     optionsAsString += "<option value='0'>Seleccione Puerto destino</option>";
                     for (var i = 0; i < cuenta; i++) {
                         optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + " - " + json[i].NombreCiudad + "</option>";
                     }
                     $('#Puerto_destino').append(optionsAsString);
                     $('#Puerto_destino').selectpicker('refresh');
                 } else {
                     //optionsAsString += "<option value='0'>Seleccione Ciudad</option>";
                     //$('#Puerto_destino').empty();
                     //$('#Puerto_destino').append(optionsAsString);
                     //$('#Puerto_destino').prop('disabled', 'disabled');
                     //$('#Puerto_destino').selectpicker('refresh');
                 }
             },
         });
     });
     //OBTENER PUERTOS DESTINO A PARTIR DE CIUDAD SELECCIONADO

     $("#Puerto_destino").change(function () {
         if ($("#Puerto_origen").val() != "") {
             if ($("#Puerto_origen").val() == $("#Puerto_destino").val()) {
                 swal('Ups!', 'Puerto Destino no puede ser igual al Puerto de Origen', 'warning');
                 $("#Pais_destino").val(0);
                 $("#Pais_destino").selectpicker("refresh");
                 $("#Ciudad_destino").val(0);
                 $("#Ciudad_destino").selectpicker("refresh");
                 $("#Puerto_destino").val(0);
                 $("#Puerto_destino").selectpicker("refresh");
                 return false;
             }
         }
         if ($("#Puerto_destino").val() != "0") {
             $.ajax({
                 type: "POST",
                 url: '@Url.Action("GetInfoPuertoDestino", "Puertos")',
                 data: { IdPuertoDestino: $("#Puerto_destino").val() },
                 success: function (response) {
                     var data = [];
                     var json = JSON.parse(response);
                     var cuenta = json.length;
                     if (cuenta != 0) {
                         $("#Pais_destino").val(json[0].IdPais);
                         $("#Pais_destino").selectpicker('refresh');
                         $("#Ciudad_destino").val(json[0].IdCiudad);
                         $("#Ciudad_destino").selectpicker('refresh');
                     }
                 },
             });
         } else {
             $.ajax({
                 type: "POST",
                 url: '@Url.Action("GetPuertos", "Puertos")',
                 success: function (response) {
                     var data = [];
                     var json = JSON.parse(response);
                     var cuenta = json.length;
                     var optionsAsString = "";
                     optionsAsString += "<option value='0'>Seleccione un Puerto de Destino</option>";

                     for (var i = 0; i < cuenta; i++) {
                         optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + " - " + json[i].NombreCiudad + "</option>";
                     }

                     $('#Puerto_destino').append(optionsAsString);
                     $('#Puerto_destino').selectpicker('refresh');
                 },
             });
         }
     });

     //OBTENER CIUDADES A PARTIR DE PAIS SELECCIONADO
     $("#Pais_origen").change(function () {
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetCiudadesPais", "Ciudad")',
             data: { IdPais: $("#Pais_origen").val() },
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 var optionsAsString1 = "";
                 if (cuenta != 0) {
                     $('#Ciudad_origen').empty();
                     optionsAsString += "<option value='0'>Seleccione Ciudad</option>";
                     for (var i = 0; i < cuenta; i++) {
                         optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + " - " + json[i].NombrePais + "</option>";
                     }
                     $('#Ciudad_origen').append(optionsAsString);
                     $('#Ciudad_origen').selectpicker('refresh');
                 } else {
                     //optionsAsString += "<option value='0'>Seleccione Ciudad</option>";
                     //$('#Ciudad_origen').empty();
                     //$('#Ciudad_origen').append(optionsAsString);
                     //$('#Ciudad_origen').prop('disabled', 'disabled');
                     //$('#Ciudad_origen').selectpicker('refresh');
                 }
             },
         });
     });
     //OBTENER CIUDADES A PARTIR DE PAIS SELECCIONADO

     //OBTENER PUERTOS ORIGEN A PARTIR DE CIUDAD SELECCIONADO
     $("#Ciudad_origen").change(function () {
         $('#Puerto_origen').removeAttr('disabled');
         $.ajax({
             type: "POST",
             url: '@Url.Action("GetPuertosOrigenCiudad", "Puertos")',
             data: { IdCiudad: $("#Ciudad_origen").val() },
             success: function (response) {
                 var data = [];
                 var json = JSON.parse(response);
                 var cuenta = json.length;
                 var optionsAsString = "";
                 var optionsAsString1 = "";
                 if (cuenta != 0) {
                     $('#Puerto_origen').empty();
                     optionsAsString += "<option value='0'>Seleccione Puerto origen</option>";
                     for (var i = 0; i < cuenta; i++) {
                         optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + " - " + json[i].NombreCiudad + "</option>";
                     }
                     $('#Puerto_origen').append(optionsAsString);
                     $('#Puerto_origen').selectpicker('refresh');
                 } else {
                     //optionsAsString += "<option value='0'>Seleccione Ciudad</option>";
                     //$('#Puerto_origen').empty();
                     //$('#Puerto_origen').append(optionsAsString);
                     //$('#Puerto_origen').prop('disabled', 'disabled');
                     //$('#Puerto_origen').selectpicker('refresh');
                 }
             },
         });
     });
     //OBTENER PUERTOS ORIGEN A PARTIR DE CIUDAD SELECCIONADO

     $("#Puerto_origen").change(function () {
         if ($("#Puerto_destino").val() != "") {
             if ($("#Puerto_origen").val() == $("#Puerto_destino").val()) {
                 swal('Ups!', 'Puerto Origen no puede ser igual al Puerto de destino', 'warning');
                 $("#Pais_origen").val(0);
                 $("#Pais_origen").selectpicker("refresh");
                 $("#Ciudad_origen").val(0);
                 $("#Ciudad_origen").selectpicker("refresh");
                 $("#Puerto_origen").val(0);
                 $("#Puerto_origen").selectpicker("refresh");
                 return false;
             }
         }
         if ($("#Puerto_origen").val() != "0") {
             $.ajax({
                 type: "POST",
                 url: '@Url.Action("GetInfoPuertoOrigen", "Puertos")',
                 data: { IdPuertoOrigen: $("#Puerto_origen").val() },
                 success: function (response) {
                     var data = [];
                     var json = JSON.parse(response);
                     var cuenta = json.length;
                     if (cuenta != 0) {
                         $("#Pais_origen").val(json[0].IdPais);
                         $("#Pais_origen").selectpicker('refresh');
                         $("#Ciudad_origen").val(json[0].IdCiudad);
                         $("#Ciudad_origen").selectpicker('refresh');
                     }
                 },
             });
         } else {
             $.ajax({
                 type: "POST",
                 url: '@Url.Action("GetPuertos", "Puertos")',
                 success: function (response) {
                     var data = [];
                     var json = JSON.parse(response);
                     var cuenta = json.length;
                     var optionsAsString = "";
                     optionsAsString += "<option value='0'>Seleccione un Puerto de Origen</option>";

                     for (var i = 0; i < cuenta; i++) {
                         optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + " - " + json[i].NombreCiudad + "</option>";
                     }

                     $('#Puerto_origen').append(optionsAsString);
                     $('#Puerto_origen').selectpicker('refresh');
                 },
             });
         }
     });

     $("#Editar").click(function () {


        if ($("#IdReserva").val() != "") {
            if ($("#Estado").val() != "CANCELLED BOOKING") {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("GetReservaById", "Reservas")',
                    data: { IdReserva: $("#IdReserva").val() },
                    success: function (response) {
                        var json = JSON.parse(response);
                        var cuenta = 0;
                        cuenta = json.length;

                        if (json[0].FechaIniStacking == null) {
                            var fechainistacking = "";
                        } else {
                            var fechainistacking = formatDate(json[0].FechaIniStacking);
                        }

                        if (json[0].FechaIniStacking == null) {
                            var fechafinstacking = "";
                        } else {
                            var fechafinstacking = formatDate(json[0].FechaFinStacking);
                        }

                        if (json[0].Etd == null) {
                            var etd = "";
                        } else {
                            var etd = formatDate(json[0].Etd);
                        }

                        $("#Booking").val(json[0].Booking);
                        $('select[name=Naviera]').val(json[0].IdNaviera);
                        $('select[name=Naves]').val(json[0].IdNave);
                        $('select[name=Pais_exportador]').val(json[0].IdPaisExportador);
                        $('select[name=Exportador]').val(json[0].IdExportador);
                        $('select[name=FreightForwarder]').val(json[0].IdFreightForwarder);
                        $('select[name=Commodity]').val(json[0].IdCommodity);
                        $('select[name=Setpoint]').val(json[0].IdSetpoint);
                        $('select[name=Pais_origen]').val(json[0].IdPaisOrigen);
                        $('select[name=Ciudad_origen]').val(json[0].IdCiudadOrigen);
                        $('select[name=Puerto_origen]').val(json[0].IdPuertoOrigen);
                        $('select[name=Pais_destino]').val(json[0].IdPaisDestino);
                        $('select[name=Ciudad_destino]').val(json[0].IdCiudadDestino);
                        $('select[name=Puerto_destino]').val(json[0].IdPuertoDestino);
                        $('select[name=Pais_origen]').val(json[0].IdPaisOrigen);
                        $("#Consignatario").val(json[0].Consignatario);
                        $("#Inicio_stacking").val(fechafinstacking);
                        $("#Termino_stacking").val(fechainistacking);
                        $("#Viaje").val(json[0].Viaje);
                        $("#Eta").val(formatDate(json[0].Eta));
                        $("#Etd").val(etd);
                        $("#Cantidad_servicios").val(json[0].CantidadServicios);
                        $("#TemperaturaEditar").val(json[0].Temperatura);
                        $('.selectpicker').selectpicker('refresh');
                    }
            });
                $('#EditarReserva').trigger('click');
         } else {
             swal('Ups!', '<span> No puede Editar una Reserva que ha sido Cancelada.</span>', 'error');
         }
     }else{
        swal('Ups!', '<span class="alerta" key="erroreditarreserva"> Debe Seleccionar una reserva para poder editarla.</span>', 'error');
     }
     });

     $("#Detalle").click(function () {
         var table = $('#Tb_detalle').DataTable();
         //enviar datos para agregar Naviera
         if ($("#IdReserva").val() != "") {
             table.destroy();
             $.ajax({
                 type: "POST",
                 url: '@Url.Action("DetalleReservaServicio", "Reservas")',
                 data: { IdReserva: $("#IdReserva").val() },
                 success: function (response) {
                     var json = JSON.parse(response);
                     var data = [];
                     var cuenta = json.length;
                     if (json.Booking != null) {
                         var Booking = json.Booking;
                     } else {
                         var Booking = $("#Booking").val()
                     }
                     if(json.Reservados<json.TotalServicios)
                     {
                         var porprestar=0;
                     }else
                     {
                         var porprestar = Math.abs(json.Reservados - json.TotalServicios);
                     }
                     
                     data.push([Booking,
                                json.Reservados,
                                json.TotalServicios,
                                porprestar,
                                json.EnViaje,
                                json.Cancelados,
                                json.NoRecuperados,
                                json.Recuperados,
                                json.EnLab]);

                     var table = $('#Tb_detalle').DataTable({
                         data: data,
                         paging: false,
                         searching: false,
                         ordering: false,
                         info: false
                     });
                     $('#Detalles').trigger('click');
                 }
             });
         } else {
             swal('Ups!', '<span class="alerta" key="errordetallesreserva">Debe seleccionar una Reserva para poder visualizar su Detalle.</span>', 'error');
         }
     });


     $("#Modificaciones").click(function () {
         var table = $('#Tb_Operaciones').DataTable();
         //enviar datos para agregar Naviera
         if ($("#IdReserva").val() != "") {
             table.destroy();
             $.ajax({
                 type: "POST",
                 url: '@Url.Action("GetModificaciones", "Reservas")',
                 data: { IdReserva: $("#IdReserva").val() },
                 success: function (response) {
                     var data = [];
                     var json = JSON.parse(response);
                     var cuenta = json.length;
                     for (var i = 0 ; i < cuenta ; i++) {
                         if (json[i].Estado == 0) {
                             estado = "INGRESSED BOOKING";
                         } else if (json[i].Estado == 1) {
                             estado = "CANCELLED BOOKING";
                         } else if (json[i].Estado == 2) {
                             estado = "FINISHED BOOKING";
                         }
                         data.push([json[i].Id, json[i].Usuario, formatDate(json[i].Fecha), json[i].Operacion,
                                    json[i].PuertoDestino, json[i].PuertoOrigen, json[i].Setpoint,json[i].Commodity,
                                    json[i].Freightforwarder, json[i].Booking, json[i].Viaje, json[i].Consignatario, json[i].Cantidadservicios,
                                    formatDate(json[i].Eta), json[i].Nave, formatDate(json[i].Etd), formatDate(json[i].Fechainistacking), formatDate(json[i].Fechafinstacking),
                                    json[i].Exportador, estado]);
                     }

                     $('#Tb_Operaciones tfoot th').each(function (i) {
                         var title = $('#Tb_Operaciones thead th').eq($(this).index()).text();
                         if (lenguaje == "es") {
                             $(this).html('<input class="form-control" type="text" placeholder="FILTRAR"/>');
                         } else {

                             $(this).html('<input class="form-control" type="text" placeholder="FILTER" />');
                         }
                     });

                     if (lenguaje == "es") {
                         var table = $('#Tb_Operaciones').DataTable({
                             data: data,
                             "language": {
                                 "lengthMenu": "Mostrar _MENU_ Resultados por pagina",
                                 "zeroRecords": "No hay Resultados para mostrar",
                                 "info": "Mostrando pagina _PAGE_ de _PAGES_ paginas",
                                 "infoEmpty": "No hay Resultados disponibles",
                                 "search": "Buscar: ",
                                 "paginate": {
                                     "first": "Primera",
                                     "last": "Última",
                                     "next": "Siguiente",
                                     "previous": "Anterior"
                                 }
                             }
                         });
                     } else {
                         var table = $('#Tb_Operaciones').DataTable({
                             data: data
                         });
                     }

                     table.columns().every(function () {
                         var that = this;
                         $('input', this.footer()).on('keyup change', function () {
                             if (that.search() !== this.value) {
                                 that
                                     .search(this.value)
                                     .draw();
                             }
                         });

                         $('select', this.footer()).on('change', function () {
                             if (that.search() !== this.value) {
                                 that
                                     .search(this.value)
                                     .draw();
                             }
                         });
                     });

                     $('#Tb_Operaciones tbody').on('click', 'tr', function () {
                         if (cuenta != 0) {
                             if ($(this).hasClass('selected')) {
                                 //$("#IdServicio").val(this.children[0].innerText);
                                 //$("#IdControlador").val(this.children[5].innerText);
                                 $(this).removeClass('selected');
                             }
                             else {
                                 table.$('tr.selected').removeClass('selected');
                                 //$("#IdServicio").val(this.children[0].innerText);
                                 //$("#IdControlador").val(this.children[5].innerText);
                                 $(this).addClass('selected');
                             }
                         }
                     });
                 },
             });
             $('#ModificacionesReservaModal').trigger('click');
         } else {
             swal('Ups!', '<span class="alerta" key="errormodificacionesreserva">Debe seleccionar una Reserva para poder visualizar sus Modificaciones.</span>', 'error');
         }
     });

     $("#Cancelar").click(function () {
         if ($("#IdReserva").val() != "") {
             if ($("#Estado").val() != "RESERVA CANCELADA") {
                 swal({
                     showCancelButton: true,
                     cancelButtonText: "<span class='alerta' key='botonsalircancelarreserva'>No, Salir</span>",
                     confirmButtonColor: '#3085d6',
                     cancelButtonColor: '#d33',
                     confirmButtonText: "<span class='alerta' key='botoncancelarreservamodal'>Si, Cancelar!</span>",
                     title: "<span class='alerta' key='titulocancelarreserva'>Agregar Motivo de Cancelacion</span>",
                     html:
                        '<div class="row">' +
                            '<div class="form-group col-lg-12">' +
                                '<label for="Motivo"></label>' +
                                '<textarea class="form-control" id="Motivo" rows="5" style="resize:none;"></textarea>' +
                            '</div>' +
                        '</div>',
                 }).then(function (result) {
                     if ($("#Motivo").val() != "") {
                         $.ajax({
                             type: "POST",
                             url: '@Url.Action("CancelarReserva", "Reservas")',
                             data: { IdReserva: $("#IdReserva").val(), Motivo: $("#Motivo").val() },
                             success: function (response) {
                                 var json = JSON.parse(response);
                                 if (json.validador == 0) {
                                     var aux = 'success';
                                 } else {
                                     var aux = 'warning';
                                 }
                                 swal({
                                     title: '',
                                     text: json.Mensaje,
                                     type: aux,
                                     showCancelButton: false,
                                     confirmButtonColor: '#3085d6',
                                     cancelButtonColor: '#d33',
                                     confirmButtonText: 'Aceptar'
                                 }).then((result) => {
                                     location.reload();
                                 })
                             }
                         });
                     } else {
                         swal('Ups!', '<span class="alerta" key="errormotivo">Debes indicar el motivo para cancerlar la Reserva</span>', 'error');
                     }
                 }).catch(swal.noop)
             } else {
                 swal('Ups!', '<span class="alerta" key="errorcancelarreservacancelada">No puede Cancelar una Reserva que ya ha sido Cancelada</span>', 'error');
             }
         }else{
             swal('Ups!', '<span class="alerta" key="errorcancerlarreserva">Debe Seleccionar una Reserva para Cancelar </span>', 'error');
         }
     });

     $("#Limpiar").click(function () {
         location.reload();
     });


     $("#EditarReservaServicio").click(function () {
         if ($("#Booking").val() == "") {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0.4)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0");
         } else if ($("#Naviera").val() == "0") {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0.4)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0");
         } else if ($("#Exportador").val() == "0" || $("#Exportador").val() == null) {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0.4)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0");
         } else if ($("#Commodity").val() == "0") {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0.4)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0");
         } else if ($("#Setpoint").val() == "0") {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0.4)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0");
         } else if ($("#Puerto_origen").val() == "0" || $("#Puerto_origen").val() == null) {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0.4)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0");
         } else if ($("#Puerto_destino").val() == "0" || $("#Puerto_destino").val() == null) {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0.4)");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0");
         } else if ($("#Etd").val() == "") {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Etd").css("background-color", "rgba(255, 0, 0, 0.4)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0");
         } else if ($("#Eta").val() == "") {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0.4)");
             $("#Etd").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0");
         } else if ($("#Cantidad_servicios").val() <= 0 || $("#Cantidad_servicios").val() == "") {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Etd").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0.4");
         } else if ($("#TemperaturaEditar").val() == "") {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Etd").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0");
             $("#TemperaturaEditar").css("background-color", "rgba(255, 0, 0, 0.4");
         } else {
             $("#Booking").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Naviera]").css("background", "rgba(255, 0, 0, 0)");
             $("button[data-id=Exportador]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Commodity]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Setpoint]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_origen]").css("background-color", "rgba(255, 0, 0, 0)");
             $("button[data-id=Puerto_destino]").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Cantidad_servicios").css("background-color", "rgba(255, 0, 0, 0");
             $("#Eta").css("background-color", "rgba(255, 0, 0, 0)");
             $("#Etd").css("background-color", "rgba(255, 0, 0, 0)");
             $("#TemperaturaEditar").css("background-color", "rgba(255, 0, 0, 0");

             $.ajax({
                 type: "POST",
                 url: '@Url.Action("EditarReserva", "Reservas")',
                 data: {
                     IdReserva: $("#IdReserva").val(),
                     IdNaviera: $("#Naviera").val(),
                     IdPuertoDestino: $("#Puerto_destino").val(),
                     IdPuertoOrigen: $("#Puerto_origen").val(),
                     IdSetpoint: $("#Setpoint").val(),
                     IdCommodity: $("#Commodity").val(),
                     IdFreightForwarder: $("#FreightForwarder").val(),
                     Booking: $("#Booking").val(),
                     Viaje: $("#Viaje").val(),
                     Consignatario: $("#Consignatario").val(),
                     CantServicios: $("#Cantidad_servicios").val(),
                     Eta: $("#Eta").val(),
                     IdNave: $("#Naves").val(),
                     Etd:  $("#Etd").val(),
                     FechaIniStacking: $("#Inicio_stacking").val(),
                     FechaFinStacking: $("#Termino_stacking").val(),
                     IdExportador: $("#Exportador").val(),
                     Temperatura: $("#TemperaturaEditar").val()
                 },
                 success: function (response) {
                     var json = JSON.parse(response);
                     if (json.validador == 0) {
                         var aux = 'success';
                     } else {
                         var aux = 'warning';
                     }
                     swal({
                         title: '',
                         text: json.Mensaje,
                         type: aux,
                         showCancelButton: false,
                         confirmButtonColor: '#3085d6',
                         cancelButtonColor: '#d33',
                         confirmButtonText: 'Aceptar'
                     }).then((result) => {
                         location.reload();
                     })
                 }
             });
         }
     });


     $("#Cantidad_servicios").keyup(function () {
         if ($("#Cantidad_servicios").val() <= 0) {
             swal('Ups!', 'Cantidad de servicios debe ser mayor a 0', 'warning');
             $("#Cantidad_servicios").val("");
             return false;
         }
     });

     $("#Inicio_stacking").change(function () {
         if ($("#Termino_stacking").val() != "") {
             var diainicio = $("#Inicio_stacking").val().substring(0, 2);
             var mesinicio = $("#Inicio_stacking").val().substring(3, 5);
             var anoinicio = $("#Inicio_stacking").val().substring(6, 10);
             var diatermino = $("#Termino_stacking").val().substring(0, 2);
             var mestermino = $("#Termino_stacking").val().substring(3, 5);
             var anotermino = $("#Termino_stacking").val().substring(6, 10);
             var inicio = new Date(mesinicio + "/" + diainicio + "/" + anoinicio);
             var termino = new Date(mestermino + "/" + diatermino + "/" + anotermino);
             if (termino.getTime() < inicio.getTime()) {
                 swal('Ups!', 'Fecha Inicio de Stacking debe ser menor a la fecha Termino Stacking', 'warning');
                 $("#Inicio_stacking").val("");
                 return false;
             }
         }
     });

     $("#Termino_stacking").change(function () {
         if ($("#Inicio_stacking").val() != "") {
             var diainicio = $("#Inicio_stacking").val().substring(0, 2);
             var mesinicio = $("#Inicio_stacking").val().substring(3, 5);
             var anoinicio = $("#Inicio_stacking").val().substring(6, 10);
             var diatermino = $("#Termino_stacking").val().substring(0, 2);
             var mestermino = $("#Termino_stacking").val().substring(3, 5);
             var anotermino = $("#Termino_stacking").val().substring(6, 10);
             var inicio = new Date(mesinicio + "/" + diainicio + "/" + anoinicio);
             var termino = new Date(mestermino + "/" + diatermino + "/" + anotermino);
             if (termino.getTime() < inicio.getTime()) {
                 swal('Ups!', 'Fecha Termino de Stacking debe ser mayor a la fecha Inicio Stacking', 'warning');
                 $("#Termino_stacking").val("");
                 return false;
             }
         }
     });

     $("#Etd").change(function () {
         if ($("#Eta").val() != "") {
             var diaetd = $("#Etd").val().substring(0, 2);
             var mesetd = $("#Etd").val().substring(3, 5);
             var anoetd = $("#Etd").val().substring(6, 10);
             var diaeta = $("#Eta").val().substring(0, 2);
             var meseta = $("#Eta").val().substring(3, 5);
             var anoeta = $("#Eta").val().substring(6, 10);
             var etd = new Date(mesetd + "/" + diaetd + "/" + anoetd);
             var eta = new Date(meseta + "/" + diaeta + "/" + anoeta);
             if (eta.getTime() < etd.getTime()) {
                 swal('Ups!', 'ETD debe ser menor al ETA', 'warning');
                 $("#Etd").val("");
                 return false;
             }
         }
     });

     $("#Eta").change(function () {
         if ($("#Etd").val() != "") {
             var diaetd = $("#Etd").val().substring(0, 2);
             var mesetd = $("#Etd").val().substring(3, 5);
             var anoetd = $("#Etd").val().substring(6, 10);
             var diaeta = $("#Eta").val().substring(0, 2);
             var meseta = $("#Eta").val().substring(3, 5);
             var anoeta = $("#Eta").val().substring(6, 10);
             var etd = new Date(mesetd + "/" + diaetd + "/" + anoetd);
             var eta = new Date(meseta + "/" + diaeta + "/" + anoeta);
             if (eta.getTime() < etd.getTime()) {
                 swal('Ups!', 'ETA debe ser mayor al ETD', 'warning');
                 $("#Eta").val("");
                 return false;
             }
         }
     });

     function validarfechas(Etd) {
         var today = new Date();
         var dd = today.getDate();
         var mm = today.getMonth() + 1; //January is 0!
         var yyyy = today.getFullYear();

         if (dd < 10) {
             dd = '0' + dd
         }

         if (mm < 10) {
             mm = '0' + mm
         }

         today = mm + "/" +dd+ "/" +yyyy;
         var fechareal = (new Date(today)).getTime();
         //sumar dos días a la fecha actual
         fechareal += 1000 * 60 * 60 * 24 * 2;
         // create a new Date object, using the adjusted time
         fechareal = new Date(fechareal);
         //obtengo los milisegundos de la fecha actual + 2 días para igual con etd
         var fechareal = fechareal.getTime();

         var diainicio = Etd.substring(0, 2);
         var mesinicio = Etd.substring(3, 5);
         var anoinicio = Etd.substring(6, 10);

         var inicio = ((new Date(mesinicio + "/" + diainicio + "/" + anoinicio))).getTime();

         if (fechareal >= inicio) {
             return 0;
         } else {
             return 1;
         }

     }
 </script>
