
@{
    ViewBag.Title = "VisualizarAprobadosDisponibles";
    Layout = "~/Views/MasterPage.cshtml";
    int PerfilInterior = Convert.ToInt32(Session["PerfilInterior"]);
    string Usuario = Session["User"].ToString().ToUpper();
}
<div class="col-sm-12">
    <div class="x_panel">
        <div class="x_title">
            <h2 class="tr" key="gestionarcontenedores">Gestionar / Visualizar Contenedores</h2>
            <div class="clearfix"></div>
        </div>
        <div class="x_content">
            <div class="x_panel">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label for="Estado" class="control-label col-sm-1 tr" key="estadocontenedores">Estado</label>
                        <div class="col-sm-10">
                            <select class="selectpicker form-control" data-live-search="true" id="Estado">
                                <option value="1" selected>AVAILABLE</option>
                                <option value="2">CANCELLED</option>
                                <option value="3">TIMED OUT</option>
                                <option value="4">IN SERVICE</option>
                                <option value="5">REJECTED</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="x_panel">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <table id="Tb_Contenedores" class="table table-striped table-bordered display nowrap">
                        <thead>
                            <tr>
                                <th class="tr" key="alerta">ALERTA</th>
                                <th class="tr" key="idcontainer">ID CONTENEDOR</th>
                                <th class="tr" key="contenedortabla">CONTENEDOR</th>
                                <th class="tr" key="gestiontabla">ULT. GESTION REALIZADA</th>
                                <th class="tr" key="fechagestiontabla">FECHA ULT. GESTION REALIZADA</th>
                                <th class="tr" key="estadocontroladortabla">ESTADO OPERACION CONTROLADOR</th>
                                <th class="tr" key="estadomodemtabla">ESTADO OPERACION MODEM</th>
                                <th class="tr" key="">DIAS CONSUMO TRAVELING CONTROLADOR</th>
                                <th class="tr" key="">DIAS CONSUMO SLEEP CONTROLADOR</th>
                                <th class="tr" key="">DIAS CONSUMO TRAVELING MODEM</th>
                                <th class="tr" key="">DIAS CONSUMO SLEEP MODEM</th>
                                <th class="tr" key="maquinariatabla">MAQUINARIA</th>
                                <th class="tr" key="cajacontenedortabla">CAJA CONTENEDOR</th>
                                <th class="tr" key="anocontenedortabla">AÑO CONTENEDOR</th>
                                <th class="tr" key="controladortabla">CONTROLADOR</th>
                                <th class="tr" key="bateriatabla">BATERIA CONTROLADOR</th>
                                <th class="tr" key="fechabateriatabla">FECHA INST. BATERIA CONTROLADOR</th>
                                <th class="tr" key="modemtabla">MODEM</th>
                                <th class="tr" key="bateriamodemtabla">BATERIA MODEM</th>
                                <th class="tr" key="fechabateriatabla">FECHA INST. BATERIA MODEM</th>
                                <th>SCRUBBER</th>
                                <th class="tr" key="paissolicitud">PAIS</th>
                                <th class="tr" key="ciudadsolicitud">CIUDAD</th>
                                <th class="tr" key="depositosolicitud">DEPOSITO</th>
                                <th class="tr" key="navierasolicitud">NAVIERA</th>
                                <th class="tr" key="idsolicitud">ID SOLICITUD LEAKTEST</th>
                                <th class="tr" key="fechaejecuciontabla">FECHA EJECUCION</th>
                                <th class="tr" key="KitCortina">CONTIENE KIT CORTINA</th>
                            </tr>
                            <tr>
                                <th class="tr" key="alerta">ALERTA</th>
                                <th class="tr" key="idcontainer">ID CONTENEDOR</th>
                                <th class="tr" key="contenedortabla">CONTENEDOR</th>
                                <th class="tr" key="gestiontabla">ULT. GESTION REALIZADA</th>
                                <th class="tr" key="fechagestiontabla">FECHA ULT. GESTION REALIZADA</th>
                                <th class="tr" key="estadocontroladortabla">ESTADO OPERACION CONTROLADOR</th>
                                <th class="tr" key="estadomodemtabla">ESTADO OPERACION MODEM</th>
                                <th class="tr" key="">DIAS CONSUMO TRAVELING CONTROLADOR</th>
                                <th class="tr" key="">DIAS CONSUMO SLEEP CONTROLADOR</th>
                                <th class="tr" key="">DIAS CONSUMO TRAVELING MODEM</th>
                                <th class="tr" key="">DIAS CONSUMO SLEEP MODEM</th>
                                <th class="tr" key="maquinariatabla">MAQUINARIA</th>
                                <th class="tr" key="cajacontenedortabla">CAJA CONTENEDOR</th>
                                <th class="tr" key="anocontenedortabla">AÑO CONTENEDOR</th>
                                <th class="tr" key="controladortabla">CONTROLADOR</th>
                                <th class="tr" key="bateriatabla">BATERIA CONTROLADOR</th>
                                <th class="tr" key="fechabateriatabla">FECHA INST. BATERIA CONTROLADOR</th>
                                <th class="tr" key="modemtabla">MODEM</th>
                                <th class="tr" key="bateriamodemtabla">BATERIA MODEM</th>
                                <th class="tr" key="fechabateriatabla">FECHA INST. BATERIA MODEM</th>
                                <th>SCRUBBER</th>
                                <th class="tr" key="paissolicitud">PAIS</th>
                                <th class="tr" key="ciudadsolicitud">CIUDAD</th>
                                <th class="tr" key="depositosolicitud">DEPOSITO</th>
                                <th class="tr" key="navierasolicitud">NAVIERA</th>
                                <th class="tr" key="idsolicitud">ID SOLICITUD LEAKTEST</th>
                                <th class="tr" key="fechaejecuciontabla">FECHA EJECUCION</th>
                                <th class="tr" key="KitCortina">CONTIENE KIT CORTINA</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr>
                                <th class="tr" key="alerta">ALERTA</th>
                                <th class="tr" key="idcontainer">ID CONTENEDOR</th>
                                <th class="tr" key="contenedortabla">CONTENEDOR</th>
                                <th class="tr" key="gestiontabla">ULT. GESTION REALIZADA</th>
                                <th class="tr" key="fechagestiontabla">FECHA ULT. GESTION REALIZADA</th>
                                <th class="tr" key="estadocontroladortabla">ESTADO OPERACION CONTROLADOR</th>
                                <th class="tr" key="estadomodemtabla">ESTADO OPERACION MODEM</th>
                                <th class="tr" key="">DIAS CONSUMO TRAVELING CONTROLADOR</th>
                                <th class="tr" key="">DIAS CONSUMO SLEEP CONTROLADOR</th>
                                <th class="tr" key="">DIAS CONSUMO TRAVELING MODEM</th>
                                <th class="tr" key="">DIAS CONSUMO SLEEP MODEM</th>
                                <th class="tr" key="maquinariatabla">MAQUINARIA</th>
                                <th class="tr" key="cajacontenedortabla">CAJA CONTENEDOR</th>
                                <th class="tr" key="anocontenedortabla">AÑO CONTENEDOR</th>
                                <th class="tr" key="controladortabla">CONTROLADOR</th>
                                <th class="tr" key="bateriatabla">BATERIA CONTROLADOR</th>
                                <th class="tr" key="fechabateriatabla">FECHA INST. BATERIA CONTROLADOR</th>
                                <th class="tr" key="modemtabla">MODEM</th>
                                <th class="tr" key="bateriamodemtabla">BATERIA MODEM</th>
                                <th class="tr" key="fechabateriatabla">FECHA INST. BATERIA MODEM</th>
                                <th>SCRUBBER</th>
                                <th class="tr" key="paissolicitud">PAIS</th>
                                <th class="tr" key="ciudadsolicitud">CIUDAD</th>
                                <th class="tr" key="depositosolicitud">DEPOSITO</th>
                                <th class="tr" key="navierasolicitud">NAVIERA</th>
                                <th class="tr" key="idsolicitud">ID SOLICITUD LEAKTEST</th>
                                <th class="tr" key="fechaejecuciontabla">FECHA EJECUCION</th>
                                <th class="tr" key="KitCortina">CONTIENE KIT CORTINA</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <div id="botonesacciones">
                    <form class="form-inline" id="botones">
                        <div class="form-group" id="labelcontenedor">
                            <label for="IdContenedor" class="control-label tr" key="idcontainer">ID CONTENEDOR</label>
                            <input type="text" class="input form-control" id="IdContenedor" disabled="disabled" style="text-align:center; text-align-last:center;" />
                            <input type="text" class="input form-control" id="NumContenedor" disabled="disabled" style="text-align:center; text-align-last:center; display:none;" hidden="hidden" />
                        </div>
                        <button type="button" class="btn btn-primary editar tr" id="AgregarGestion" key="botonagregargestion" style="margin-bottom: 0px;">Agregar Nueva Gestion</button>
                        <button type="button" class="btn btn-primary editar tr" id="InvetarioContenedor" key="botondisponibilizarcontenedor" style="margin-bottom: 0px;">Disponibilizar Contenedor</button>
                        <button type="button" class="btn btn-danger editar tr" id="CancelarContenedor" key="botoncancelarcontenedor" style="margin-bottom: 0px;">Cancelar Contenedor</button>
                        <button type="button" class="btn btn-warning tr " id="QuitarScrubber" key="QuitarScrubber" style="margin-bottom: 0px;">Quitar Scrubber</button>
                    </form>
                </div>

            </div>

        </div>
    </div>
</div>
<!--Modal para Agregar Gestion-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="margin-left:80px; margin-right:10px;">
    <div class="modal-dialog" role="document" style="width:100%">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title tr" id="myModalLabel" key="titulologisticacontrolador"> Agregar Nueva Gestión</h4>
            </div>
            <div class="modal-body">
                <div class="row x_panel">
                    <div class="x_panel">
                        <form class="form-horizontal">
                            <div class="col-lg-12 col-md-12 col-sm-12 form-group">
                                <div class="col-lg-3 col-md-3 col-sm-3">
                                    <label id="lb_id" class="control-label tr" key="tipoesn">Contenedor Asociado</label>
                                </div>
                                <div class="col-md-3 col-sm-3 col-xs-3">
                                    <input type="text" disabled="disabled" class="form-control" name="contenedorSeleccionado" id="contenedorSeleccionado" />
                                </div>
                                <div class="col-lg-1 col-md-1 col-sm-1">
                                </div>
                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 form-group">
                                <div class="col-lg-3 col-md-3 col-sm-3">

                                    <label id="lb_id" class="control-label tr" key="ultimaGestion">Última Gestión (*)</label>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-6">
                                    <div>
                                        <textarea class="form-control" rows="5" id="Gestion"></textarea>
                                    </div>
                                    @*<input type="text" onkeyup="this.value = this.value.toUpperCase();" class="form-control" autocomplete="off" name="Gestion" id="Gestion" />*@
                                </div>
                            </div>
                            <div class="col-lg-12 col-md-12 col-sm-12 form-group">
                                <div class="col-lg-3 col-md-3 col-sm-3">
                                    <label id="lb_id" class="control-label">Fecha Última Gestión (*)</label>
                                </div>
                                <div class="col-md-3 col-sm-3 col-xs-3">
                                    <input type="text" id="FechaGestion" class="form-control" autocomplete="off">
                                </div>
                                <div class="col-lg-1 col-md-1 col-sm-1">
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer" id="div_botones_gestion">
                <button type="button" class="btn btn-success tr" id="Guardar_gestion" key="botonguardargestion">Guardar</button>
                <button type="button" class="btn btn-danger tr" data-dismiss="modal" key="botoncancelargestion">Cancelar</button>
            </div>
        </div>
    </div>
</div>
<!--Modal para Agregar Gestion-->
<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" id="AgregarGestionTrigger" style="display:none;"></button>
<script src="~/build/js/Perfiles.js"></script>
<script>

    //var lenguaje = document.cookie;
    var lenguaje = getCookie("Lenguaje");
    if (@PerfilInterior == 19) {
        $("#botonesacciones").hide();
    }

    $(document).ready(function () {

        $('#Tb_Contenedores thead tr:eq(1) th').each(function (i) {
            var title = $('#example thead tr:eq(0) th').eq($(this).index()).text();
            $(this).html('<input type="text" class="form-control" placeholder="FILTER" data-index="' + i + '"/>');
        });


        $.ajax({
            type: "POST",
            data: { Estado : $("#Estado").val()},
            url: '@Url.Action("GetContenedores", "Contenedores")',

            success: function (response) {
                var data = [];
                var json = JSON.parse(response);
                var cuenta = json.length;
                for (var i = 0 ; i < cuenta ; i++) {
                    var fecha="";
                    var fechaBateria="";
                    var fechaBateriaModem="";
                    var fechaGestion="";
                    if (json[i].Scrubber == 0) {
                        var scrubber = 'W/SCRUBBER';
                    } else {
                        var scrubber = 'W/O SCRUBBER';
                    }
                    if (json[i].KitCortina == 0) {
                        var kit = 'SI';
                    } else {
                        var kit = 'NO';
                    }

                    if (json[i].Fecha!=null && json[i].Fecha!="")
                    {
                        fecha=formatDate(json[i].Fecha);
                    }

                    if (json[i].FechaBateria!=null && json[i].FechaBateria!="")
                    {
                        fechaBateria=formatDate(json[i].FechaBateria);
                    }

                    if (json[i].FechaBateriaModem!=null && json[i].FechaBateriaModem!="")
                    {
                        fechaBateriaModem=formatDate(json[i].FechaBateriaModem);
                    }

                    if (json[i].FechaGestion!=null && json[i].FechaGestion!="")
                    {
                        fechaGestion=FormatDateControlador(json[i].FechaGestion);
                    }


                    data.push([json[i].DetalleAlerta, json[i].IdContenedor, json[i].NumeroContenedor,json[i].Gestion,
                               fechaGestion, json[i].EstadoOperacionControlador, json[i].EstadoOperacionModem, json[i].CONT_DIAS_TRAVELING_CONTROLADOR,json[i].CONT_DIAS_SLEEP_CONTROLADOR,
                               json[i].CONT_DIAS_TRAVELING_MODEM,json[i].CONT_DIAS_SLEEP_MODEM, json[i].NombreMaquinaria.toUpperCase(),
                               json[i].CajaContenedor.toUpperCase(), json[i].AnoContenedor, json[i].Controlador, json[i].Bateria,
                               fechaBateria, json[i].Modem, json[i].BateriaModem, fechaBateriaModem, scrubber,
                               json[i].Pais.toUpperCase(), json[i].Ciudad.toUpperCase(), json[i].Deposito.toUpperCase(),
                               json[i].Naviera.toUpperCase(), json[i].IdReserva, fecha, kit]);
                }

                if (lenguaje == "es") {

                    var table = $('#Tb_Contenedores').DataTable({
                        initComplete: function () {
                            this.api().columns().every( function () {
                                var column = this;
                                if(column.index() == 0){
                                    //alert(column.index());

                                    var select = $('<select><option value=""></option></select>')
                                        .appendTo( $(column.footer()).empty() )
                                        .on( 'change', function () {
                                            var val = $.fn.dataTable.util.escapeRegex(
                                                $(this).val()
                                            );

                                            column
                                                .search( val ? '^'+val+'$' : '', true, false )
                                                .draw();
                                        } );

                                    column.data().unique().sort().each( function ( d, j ) {
                                        select.append( '<option value="'+d+'">'+d+'</option>' )
                                    } );
                                }
                            } );
                        },
                        data: data,
                        "language": {
                            "lengthMenu": "Mostrar _MENU_ Resultados por pagina",
                            "zeroRecords": "No hay Resultados para mostrar",
                            "info": "Mostrando pagina _PAGE_ de _PAGES_ paginas",
                            "infoEmpty": "No hay Resultados disponibles",
                            "search": "Buscar: ",
                            "paginate": {
                                "first": "Primera",
                                "last": "Última",
                                "next": "Siguiente",
                                "previous": "Anterior"
                            }
                        },
                        "order": [[ 2, "desc" ]],
                        dom: 'Bfrtip',
                        buttons: [
                            'copy', 'csv', 'excel'
                        ],
                        scrollX:        true,
                        scrollCollapse: true,
                        paging:         true,
                        orderCellsTop: true,
                        "rowCallback": function (row, data, index) {
                            if (data.DetalleAlerta != null && data.DetalleAlerta != "") {
                                $('td', row).css("background-color", "rgba(255,255,0)"); //AMARILLO
                            }
                            //if (data.DiasBateria >=15) {
                            //    $('td', row).css("background-color", "rgba(255, 0, 0, 0.4);");
                            //}
                        },
                    });
                } else {
                    var table = $('#Tb_Contenedores').DataTable({
                        data: data,
                        dom: 'Bfrtip',
                        buttons: [
                            'copy', 'csv', 'excel'
                        ],
                        scrollX: true,
                        scrollCollapse: true,
                        paging: true,
                        orderCellsTop: true
                    });
                }

                $(table.table().container()).on('keyup', 'thead input', function () {
                    table
                        .column($(this).data('index'))
                        .search(this.value)
                        .draw();
                });

                $('#Tb_Contenedores tbody').on('click', 'tr', function () {
                    if (cuenta != 0) {
                        if ($(this).hasClass('selected')) {
                            $("#IdContenedor").val(this.children[1].innerText);
                            $("#NumContenedor").val(this.children[2].innerText);
                            $(this).removeClass('selected');

                        }
                        else {
                            table.$('tr.selected').removeClass('selected');
                            $("#IdContenedor").val(this.children[1].innerText);
                            $("#NumContenedor").val(this.children[2].innerText);
                            $(this).addClass('selected');
                        }
                    }
                });
            },
        });




        @*$.ajax({
            type: "POST",
            data: { Estado : $("#Estado").val() },
            url: '@Url.Action("GetContenedores", "Contenedores")',
            success: function (response) {
                var data = [];
                var json = JSON.parse(response);
                var cuenta = json.length;
                for (var i = 0 ; i < cuenta ; i++) {
                    if (json[i].Scrubber == 0) {
                        var scrubber = 'W/SCRUBBER';
                    } else {
                        var scrubber = 'W/O SCRUBBER';
                    }
                    if (json[i].KitCortina == 0) {
                        var kit = 'SI';
                    } else {
                        var kit = 'NO';
                    }
                    data.push([json[i].IdContenedor, json[i].NumeroContenedor, json[i].NombreMaquinaria.toUpperCase(), json[i].CajaContenedor.toUpperCase(),
                               json[i].AnoContenedor, scrubber, json[i].Pais.toUpperCase(), json[i].Ciudad.toUpperCase(), json[i].Deposito.toUpperCase(),
                               json[i].Naviera.toUpperCase(), json[i].IdReserva, formatDate(json[i].Fecha), kit]);

                }

                var table = $('#Tb_Contenedores').DataTable({
                    data: data,
                    dom: 'Bfrtip',
                    buttons: [
                        'copy', 'csv', 'excel'
                    ],
                    scrollX: true
                });


                $(table.table().container() ).on('keyup', 'tfoot input', function () {
                    table
                        .column( $(this).data('index'))
                        .search( this.value )
                        .draw();
                });

                $('#Tb_Contenedores tbody').on('click', 'tr', function () {
                    if ($(this).hasClass('selected')) {
                        $("#IdContenedor").val(this.children[0].innerText);
                        $(this).removeClass('selected');
                    }
                    else {
                        table.$('tr.selected').removeClass('selected');
                        $("#IdContenedor").val(this.children[0].innerText);
                        $(this).addClass('selected');
                    }
                });
            },
        });*@

        if ($("#Estado").val() == 1) {
            $("#InvetarioContenedor").hide();
        }
    });


    function diferenciaDias(FechaLeaktest) {
        var date1 = new Date(FechaLeaktest);
        var date2 = new Date();
        var timeDiff = Math.abs(date2.getTime() - date1.getTime());
        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));
        return diffDays;
    };


    $("#CancelarContenedor").click(function () {
        if ($("#IdContenedor").val() != "") {
            swal({
                title: '<span class="alerta" key="titulocancelarcontenedor">Estás Seguro de Cancelar el Contenedor?</span>',
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText:'<span class="alerta" key="botoncancelaralerta">Cancelar</span>',
                confirmButtonText: '<span class="alerta" key="botoncancelarcontenedoralerta" >Si, Cancelar!</span>'
            }).then((result) => {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("CancelarContenedor", "Contenedores")',
                    data: { IdContenedor: $("#IdContenedor").val() },
                    success: function (response) {
                        var json = JSON.parse(response);
                        if (json.validador == 0) {
                            var aux = 'success';
                        } else {
                            var aux = 'warning';
                        }
                        swal({
                            title: '',
                            text: json.Mensaje,
                            type: aux,
                            showCancelButton: false,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Aceptar'
                        }).then((result) => {
                            location.reload();
                        })
                    }
                });
            });
        } else {
            swal("Error", "<span class='alerta' key='errorcancelarcontenedor' >Debe seleccionar un contenedor para cancelarlo</span>", "error");
        }
    });

    function formatDate(date) {
        var fecha = date.substring(0, 10);
        var ano = date.substring(0, 4);
        var mes = date.substring(5, 7);
        var dia = date.substring(8, 10);
        return dia + "/" + mes + "/" + ano;
    }

    //OBTENER CONTENEDORES A PARTIR DE ESTADO SELECCIONADO
    $("#Estado").change(function () {
        var table = $('#Tb_Contenedores').DataTable();
        table.destroy();
        $("#IdContenedor").val("");
        if ($("#Estado").val() == 5 || $("#Estado").val() == 4 || $("#Estado").val() == 3) {
            $("#botones").hide();
            $("#InvetarioContenedor").hide();
            $("#CancelarContenedor").hide();
        } else {
            if ($("#Estado").val() == 1) {
                $("#botones").show();
                $("#InvetarioContenedor").hide();
                $("#CancelarContenedor").show();
                $("#QuitarScrubber").show();
            } else {
                $("#botones").show();
                $("#InvetarioContenedor").show();
                $("#CancelarContenedor").hide();
                $("#QuitarScrubber").hide();
            }
        }

        $.ajax({
            type: "POST",
            data: { Estado : $("#Estado").val() },
            url: '@Url.Action("GetContenedores", "Contenedores")',
            success: function (response) {
                var data = [];
                var json = JSON.parse(response);
                var cuenta = json.length;
                for (var i = 0 ; i < cuenta ; i++) {
                    var fecha="";
                    var fechaBateria="";
                    var fechaBateriaModem="";
                    var fechaGestion="";
                    if (json[i].Scrubber == 0) {
                        var scrubber = 'W/SCRUBBER';
                    } else {
                        var scrubber = 'W/O SCRUBBER';
                    }
                    if (json[i].KitCortina == 0) {
                        var kit = 'SI';
                    } else {
                        var kit = 'NO';
                    }

                    if (json[i].Fecha!=null && json[i].Fecha!="")
                    {
                        fecha=formatDate(json[i].Fecha);
                    }

                    if (json[i].FechaBateria!=null && json[i].FechaBateria!="")
                    {
                        fechaBateria=formatDate(json[i].FechaBateria);
                    }

                    if (json[i].FechaBateriaModem!=null && json[i].FechaBateriaModem!="")
                    {
                        fechaBateriaModem=formatDate(json[i].FechaBateriaModem);
                    }

                    if (json[i].FechaGestion!=null && json[i].FechaGestion!="")
                    {
                        fechaGestion=formatDate(json[i].FechaGestion);
                    }


                    data.push([json[i].DetalleAlerta, json[i].IdContenedor, json[i].NumeroContenedor,json[i].Gestion,
                               fechaGestion, json[i].EstadoOperacionControlador, json[i].EstadoOperacionModem, json[i].CONT_DIAS_TRAVELING_CONTROLADOR,json[i].CONT_DIAS_SLEEP_CONTROLADOR,
                               json[i].CONT_DIAS_TRAVELING_MODEM,json[i].CONT_DIAS_SLEEP_MODEM, json[i].NombreMaquinaria.toUpperCase(),
                               json[i].CajaContenedor.toUpperCase(), json[i].AnoContenedor, json[i].Controlador, json[i].Bateria,
                               fechaBateria, json[i].Modem, json[i].BateriaModem, fechaBateriaModem, scrubber,
                               json[i].Pais.toUpperCase(), json[i].Ciudad.toUpperCase(), json[i].Deposito.toUpperCase(),
                               json[i].Naviera.toUpperCase(), json[i].IdReserva, fecha, kit]);

                }

                if (lenguaje == "es") {

                    var table = $('#Tb_Contenedores').DataTable({
                        data: data,
                        "language": {
                            "lengthMenu": "Mostrar _MENU_ Resultados por pagina",
                            "zeroRecords": "No hay Resultados para mostrar",
                            "info": "Mostrando pagina _PAGE_ de _PAGES_ paginas",
                            "infoEmpty": "No hay Resultados disponibles",
                            "search": "Buscar: ",
                            "paginate": {
                                "first": "Primera",
                                "last": "Última",
                                "next": "Siguiente",
                                "previous": "Anterior"
                            }
                        },
                        dom: 'Bfrtip',
                        buttons: [
                            'copy', 'csv', 'excel'
                        ],
                        scrollX:        true,
                        scrollCollapse: true,
                        paging:         true,
                        orderCellsTop: true
                    });
                } else {
                    var table = $('#Tb_Contenedores').DataTable({
                        data: data,
                        dom: 'Bfrtip',
                        buttons: [
                            'copy', 'csv', 'excel'
                        ],
                        scrollX: true,
                        scrollCollapse: true,
                        paging: true,
                        orderCellsTop: true
                    });
                }

                $(table.table().container()).on('keyup', 'thead input', function () {
                    table
                        .column($(this).data('index'))
                        .search(this.value)
                        .draw();
                });

                $('#Tb_Contenedores tbody').on('click', 'tr', function () {
                    if (cuenta != 0) {
                        if ($(this).hasClass('selected')) {
                            $("#IdContenedor").val(this.children[1].innerText);
                            $("#NumContenedor").val(this.children[2].innerText);
                            $(this).removeClass('selected');
                        }
                        else {
                            table.$('tr.selected').removeClass('selected');
                            $("#IdContenedor").val(this.children[1].innerText);
                            $("#NumContenedor").val(this.children[2].innerText);
                            $(this).addClass('selected');
                        }
                    }
                });
            },
        });
    });
    //OBTENER CONTENEDORES A PARTIR DE ESTADO SELECCIONADO

    $("#InvetarioContenedor").click(function () {
        if ($("#IdContenedor").val() != "") {
            swal({
                title: '<span class="alerta" key="titulodisponibilizarcontenedor" >Estás Seguro de Disponibilizar el Contenedor?</span>',
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: '<span class="alerta" key="botoncancelaralerta">Cancelar</span>',
                confirmButtonText: '<span class="alerta" key="botondisponibilizarcontenedoralerta" >Si, Disponibilizar!</span>'
            }).then((result) => {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("DisponibilizarContenedor", "Contenedores")',
                    data: { IdContenedor: $("#IdContenedor").val() },
                    success: function (response) {
                        var json = JSON.parse(response);
                        if (json.validador == 0) {
                            var aux = 'success';
                        } else {
                            var aux = 'warning';
                        }
                        swal({
                            title: '',
                            text: json.Mensaje,
                            type: aux,
                            showCancelButton: false,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Aceptar'
                        }).then((result) => {
                            location.reload();
                        })
                    }
                });
            });
        } else {
            swal("Error", "<span class='alerta' key='errordisponibilizarcontenedor'>Debe seleccionar un contenedor para disponibilizarlo</span>", "error");
        }
    });

    $("#QuitarScrubber").click(function () {
        if ($("#IdContenedor").val() != "") {
            swal({
                title: '<span class="alerta" key="titulocancelarcontenedor">Estás Seguro de Quitar scrubber?</span>',
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: '<span class="alerta" key="botoncancelaralerta">Cancelar</span>',
                confirmButtonText: '<span class="alerta" key="botoncancelarcontenedoralerta" >Si, Quitar!</span>'
            }).then((result) => {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("QuitarScrubber", "Contenedores")',
                    data: { IdContenedor: $("#IdContenedor").val() },
                    success: function (response) {
                        var json = JSON.parse(response);
                        if (json.validador == 0) {
                            var aux = 'success';
                        } else {
                            var aux = 'warning';
                        }
                        swal({
                            title: '',
                            text: json.Mensaje,
                            type: aux,
                            showCancelButton: false,
                            confirmButtonColor: '#3085d6',
                            cancelButtonColor: '#d33',
                            confirmButtonText: 'Aceptar'
                        }).then((result) => {
                            location.reload();
                        })
                    }
                });
            });
        } else {
            swal("Error", "<span >Debe seleccionar un contenedor para quitar Scrubber</span>", "error");
        }
    });

    $("#AgregarGestion").click(function () {

        $("#contenedorSeleccionado").val($("#NumContenedor").val());
        $('#AgregarGestionTrigger').trigger('click');

    });

    $("#Guardar_gestion").click(function () {

        $.ajax({
            type: "POST",
            url: '@Url.Action("GuardarGestion", "Contenedores")',
            data: { IdContenedor: $("#IdContenedor").val(), Gestion: $("#Gestion").val(), FechaGestion: $("#FechaGestion").val() },
            success: function (response) {
                var json = JSON.parse(response);
                if (json.validador == 0) {
                    var aux = 'success';
                } else {
                    var aux = 'warning';
                }
                swal({
                    title: '',
                    text: json.Mensaje,
                    type: aux,
                    showCancelButton: false,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Aceptar'
                }).then((result) => {
                    location.reload();
                })
            }
        });
    });

    $(function () {
        $("#FechaGestion").datepicker({
            dateFormat: "dd-mm-yy",
            firstDay: 1,
            dayNamesMin: ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"],
            dayNamesShort: ["Dom", "Lun", "Mar", "Mie", "Jue", "Vie", "Sab"],
            monthNames:
                ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio",
                "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
            monthNamesShort:
                ["Ene", "Feb", "Mar", "Abr", "May", "Jun",
                "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
            showWeek: true
        });

        $('#FechaGestion').datetimepicker({});
    });

    function FormatDateControlador(date) {

        var fecha = date.substring(0, 10);
        var ano = date.substring(0, 4);
        var mes = date.substring(5, 7);
        var dia = date.substring(8, 10);
        var hora = date.substring(11, 13);
        var minuto = date.substring(14, 16)
        return dia + "/" + mes + "/" + ano + " " + hora + ":" + minuto;
    }

</script>

