
@{
    ViewBag.Title = "VisualizarViajes";
    Layout = "~/Views/MasterPage.cshtml";
    int PerfilInterior = Convert.ToInt32(Session["PerfilInterior"]);
    string Usuario = Session["User"].ToString().ToUpper();
}

<div class="col-sm-12">
    <div class="x_panel">
        <div class="x_title">
            <div class="row">
                <div class="col-sm-7">
                    <h2 class="tr" key="mantenedorpuertodestino">Gestionar / Visualizar Viajes</h2>
                </div>
                <div class="col-sm-3">
                    <button type="button" class="btn btn-success editar tr" id="CrearViaje" key="botonagregarviaje">Agregar Viaje</button>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="x_content">
            <div class="row">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <table id="Tb_Viajes" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th class="tr" key="tablaidviaje">ID VIAJE</th>
                                <th class="tr" key="tablaviaje">VIAJE</th>
                                <th class="tr" key="tablapuertoorigen">PUERTO ORIGEN</th>
                                <th class="tr" key="tablapuertodestino">PUERTO DESTINO</th>
                                <th class="tr" key="tablanave">NAVE</th>
                                <th class="tr" key="tablainiciostacking">INICIO STACKING</th>
                                <th class="tr" key="tablaterminostacking">TERMINO STACKING</th>
                                <th class="tr" key="tablaetanave">ETA NAVE</th>
                                <th class="tr" key="tablaetd">ETD</th>
                                <th class="tr" key="tablaetapod">ETA POD</th>
                                <th class="tr" key="tablaestado">ESTADO</th>
                                <th class="tr" key="tablavalidado">VALIDADO</th>
                            </tr>
                            <tr>
                                <th class="tr" key="tablaidviaje">ID VIAJE</th>
                                <th class="tr" key="tablaviaje">VIAJE</th>
                                <th class="tr" key="tablapuertoorigen">PUERTO ORIGEN</th>
                                <th class="tr" key="tablapuertodestino">PUERTO DESTINO</th>
                                <th class="tr" key="tablanave">NAVE</th>
                                <th class="tr" key="tablainiciostacking">INICIO STACKING</th>
                                <th class="tr" key="tablaterminostacking">TERMINO STACKING</th>
                                <th class="tr" key="tablaetanave">ETA NAVE</th>
                                <th class="tr" key="tablaetd">ETD</th>
                                <th class="tr" key="tablaetapod">ETA POD</th>
                                <th class="tr" key="tablaestado">ESTADO</th>
                                <th class="tr" key="tablavalidado">VALIDADO</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3">
                    <form class="form-inline">
                        <div class="form-group">
                            <label for="IdReserva" class="control-label tr" key="idsolicitud">ID VIAJE</label>
                            <input type="text" class="form-control" id="IdViaje" disabled="disabled" style="text-align:center; text-align-last:center;" />
                        </div>
                    </form>
                </div>
                <div class="col-lg-6">
                    @{
                        if (PerfilInterior != 1020 && PerfilInterior != 1021 && PerfilInterior != 1022)
                        {
                            <div class="col-sm-2">
                                <button type="button" class="btn btn-primary tr editar" id="EditarViaje" key="botoneditar" style="margin-bottom: 0px;">Editar Viaje</button>
                            </div>
                            <div class="col-sm-2">
                                <button type="button" class="btn btn-info tr detalle" id="ValidarViaje" key="botondetalle" style="margin-bottom: 0px;">Validar Viaje</button>
                            </div>
                            <div class="col-sm-2">
                                <button type="button" class="btn btn-danger tr eliminar" id="EliminarViaje" key="botoneliminar" style="margin-bottom: 0px;">Eliminar Viaje</button>
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
    </div>

    <!--Modal para agregar datos-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="margin-left:80px; margin-right:10px;">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" style="width:100%">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel2">Agregar Viaje</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label for="Puerto" class="alerta col-sm-2 control-label" key="nombreviaje">Viaje (*)</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="Viaje" onkeyup="this.value = this.value.toUpperCase();">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="PuertoOrigen" class="alerta col-sm-2 control-label" key="puertoorigen">Puerto de Origen (*)</label>
                            <div class="col-sm-10">
                                <select class="selectpicker form-control" data-live-search="true" id="PuertoOrigen">
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="PuertoDestino" class="alerta col-sm-2 control-label" key="puertodestino">Puerto de Destino (*)</label>
                            <div class="col-sm-10">
                                <select class="selectpicker form-control" data-live-search="true" id="PuertoDestino">
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="Nave" class="alerta col-sm-2 control-label" key="nave">Nave (*)</label>
                            <div class="col-sm-10">
                                <select class="selectpicker form-control" data-live-search="true" id="Nave">
                                    <option value="0" selected>Seleccione Nave</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="EtaNave" class="alerta col-sm-2 control-label" key="etanave">ETA Nave (*)</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="EtaNave" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="InicioStacking" class="alerta col-sm-2 control-label" key="iniciostacking">Inicio Stacking </label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="InicioStacking" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="TerminoStacking" class="alerta col-sm-2 control-label" key="terminostacking">Termino Stacking </label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="TerminoStacking" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="Etd" class="alerta col-sm-2 control-label" key="etd">ETD (*)</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="Etd" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="EtaPOD" class="alerta col-sm-2 control-label" key="etapod">ETA POD </label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="EtaPOD" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="Estado" class="alerta col-sm-2 control-label" key="estado">Estado</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="Estado">
                                    <option value="0">Activo</option>
                                    <option value="1">Deshabilitado</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success tr" id="AgregarViaje" key="botonagregarviaje">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal para agregar datos-->
    <!--Modal para editar datos-->
    <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="margin-left:80px; margin-right:10px;">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" style="width:100%">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel2">Editar Viaje</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label for="Puerto" class="alerta col-sm-2 control-label" key="nombreviaje">Viaje (*)</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="ViajeEditar" onkeyup="this.value = this.value.toUpperCase();" disabled="disabled">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="PuertoOrigen" class="alerta col-sm-2 control-label" key="puertoorigen">Puerto de Origen (*)</label>
                            <div class="col-sm-10">
                                <select class="selectpicker form-control" data-live-search="true" id="PuertoOrigenEditar" disabled="disabled"></select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="PuertoDestino" class="alerta col-sm-2 control-label" key="puertodestino">Puerto de Destino (*)</label>
                            <div class="col-sm-10">
                                <select class="selectpicker form-control" data-live-search="true" id="PuertoDestinoEditar" disabled="disabled"></select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="Nave" class="alerta col-sm-2 control-label" key="nave">Nave (*)</label>
                            <div class="col-sm-10">
                                <select class="selectpicker form-control" data-live-search="true" id="NaveEditar">
                                    <option value="0" selected>Seleccione Nave</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="EtaNave" class="alerta col-sm-2 control-label" key="etanave">ETA Nave (*)</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="EtaNaveEditar" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="InicioStacking" class="alerta col-sm-2 control-label" key="iniciostacking">Inicio Stacking (*)</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="InicioStackingEditar" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="TerminoStacking" class="alerta col-sm-2 control-label" key="terminostacking">Termino Stacking (*)</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="TerminoStackingEditar" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="Etd" class="alerta col-sm-2 control-label" key="etd">ETD (*)</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="EtdEditar" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="EtaPOD" class="alerta col-sm-2 control-label" key="etapod">ETA POD (*)</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="EtaPODEditar" autocomplete="off">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="Estado" class="alerta col-sm-2 control-label" key="estado">Estado</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="EstadoEditar">
                                    <option value="0">Activo</option>
                                    <option value="1">Deshabilitado</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success editar tr" id="EditarInformacion" key="botoneditarpuerto">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal para editar datos-->

    <input type="text" class="input form_control" id="idpuerto" disabled="disabled" style="text-align:center; text-align-last:center;" hidden />
    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" id="CrearPuertoModal" style="display:none;"></button>
    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal2" id="EditarPuertoModal" style="display:none;"></button>
</div>

<script src="~/build/js/PerfilViaje.js"></script>
<script>

    var lenguaje = document.cookie;

    //Botón Editar Perfil//
    $(document).ready(function () {

        $('#Tb_Viajes thead tr:eq(1) th').each(function (i) {
            var title = $('#example thead tr:eq(0) th').eq($(this).index()).text();
            $(this).html('<input type="text" class="form-control" placeholder="FILTER" data-index="' + i + '"/>');
        });

        $.ajax({
            type: "POST",
            url: '@Url.Action("GetViajes", "Viaje")',
            success: function (response) {
                var data = [];
                var json = JSON.parse(response);
                var cuenta = json.length;
                $('#Tb_Viajes').show(500);
                for (var i = 0 ; i < cuenta ; i++) {

                    if (json[i].Estado == 0) {
                        var estado = 'ACTIVO';
                    } else {
                        var estado = 'DESHABILITADO';
                    }

                    if (json[i].Validado == 0) {
                        var validado = 'SI';
                    } else {
                        var validado = 'NO';
                    }

                    data.push([json[i].Id, json[i].NumeroViaje, json[i].PuertoOrigen, json[i].PuertoDestino, json[i].Nave, formatDate(json[i].InicioStacking), formatDate(json[i].FinStacking), formatDate(json[i].EtaNave), formatDate(json[i].Etd), formatDate(json[i].EtaPod), estado, validado]);
                }

                if (lenguaje == "es") {
                    var table = $('#Tb_Viajes').DataTable({
                        data: data,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
                        },
                    });
                } else {
                    var table = $('#Tb_Viajes').DataTable({
                        data: data,
                        fixedColumns: true,
                        "ordering": false
                    });
                }

                $( table.table().container() ).on('keyup', 'thead input', function () {
                    table
                        .column( $(this).data('index'))
                        .search( this.value )
                        .draw();
                });

                $('#Tb_Viajes tbody').on('click', 'tr', function () {
                    if (cuenta != 0) {
                        if ($(this).hasClass('selected')) {
                            $("#IdViaje").val(this.children[0].innerText);
                            $(this).removeClass('selected');
                        }
                        else {
                            table.$('tr.selected').removeClass('selected');
                            $("#IdViaje").val(this.children[0].innerText);
                            $(this).addClass('selected');
                        }
                    }
                });
            },
        });
    });
    //Botón Editar puerto//

    //boton crear puerto//
    $("#CrearViaje").click(function () {

        $('#CrearPuertoModal').trigger('click');
        $("#Puerto").val("");
        $("#Puerto").css("background-color", "rgba(255, 0, 0, 0)");
        $('#Puerto').focus();
        if(@PerfilInterior == 1021 || @PerfilInterior == 1022){
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetPuertosSP", "Puertos")',
                success: function (response) {
                    var data = [];
                    var json = JSON.parse(response);
                    var cuenta = json.length;
                    var optionsAsString = "";
                    $('#PuertoOrigen').empty();
                    optionsAsString = "<option value='0' selected>Seleccione Puerto</option>";
                    for (var i = 0; i < cuenta; i++) {
                        if (json[i].Id != 0)
                        {
                            optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + "</option>";
                        }
                    }
                    $('#PuertoOrigen').append(optionsAsString);
                    $('#PuertoOrigen').selectpicker('refresh');
                },
            });

            $.ajax({
                type: "POST",
                url: '@Url.Action("GetPuertos", "Puertos")',
                success: function (response) {
                    var data = [];
                    var json = JSON.parse(response);
                    var cuenta = json.length;
                    var optionsAsString = "";
                    $('#PuertoDestino').empty();
                    optionsAsString = "<option value='0' selected>Seleccione Puerto</option>";
                    for (var i = 0; i < cuenta; i++) {
                        if (json[i].Id != 0)
                        {
                            optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + "</option>";
                        }
                    }

                    $('#PuertoDestino').append(optionsAsString);
                    $('#PuertoDestino').selectpicker('refresh');
                },
            });
        }else{
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetPuertos", "Puertos")',
                success: function (response) {
                    var data = [];
                    var json = JSON.parse(response);
                    var cuenta = json.length;
                    var optionsAsString = "";
                    $('#PuertoOrigen').empty();
                    $('#PuertoDestino').empty();
                    optionsAsString = "<option value='0' selected>Seleccione Puerto</option>";
                    for (var i = 0; i < cuenta; i++) {
                        if (json[i].Id != 0)
                        {
                            optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + "</option>";
                        }
                    }
                    $('#PuertoOrigen').append(optionsAsString);
                    $('#PuertoOrigen').selectpicker('refresh');
                    $('#PuertoDestino').append(optionsAsString);
                    $('#PuertoDestino').selectpicker('refresh');
                },
            });
        }


        $.ajax({
            type: "POST",
            url: '@Url.Action("GetNaves", "Nave")',
            success: function (response) {
                var data = [];
                var json = JSON.parse(response);
                var cuenta = json.length;
                var optionsAsString = "";
                $('#Nave').empty();
                optionsAsString = "<option value='0' selected>Seleccione Nave</option>";
                for (var i = 0; i < cuenta; i++) {
                    if (json[i].IdNave != 0) {
                        optionsAsString += "<option value='" + json[i].IdNave + "'>" + json[i].NombreNave + "</option>";
                    }
                }
                $('#Nave').append(optionsAsString);
                $('#Nave').selectpicker('refresh');
            },
        });
    });
    //boton crear puerto//


    //boton crear puerto//
    $("#EditarViaje").click(function () {

        if ($("#IdViaje").val() != "")
        {
            $('#EditarPuertoModal').trigger('click');
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetPuertos", "Puertos")',
                async: false,
                success: function (response) {
                    var data = [];
                    var json = JSON.parse(response);
                    var cuenta = json.length;
                    var optionsAsString = "";
                    $('#PuertoOrigenEditar').empty();
                    $('#PuertoDestinoEditar').empty();
                    optionsAsString = "<option value='0' selected>Seleccione Puerto</option>";
                    for (var i = 0; i < cuenta; i++) {
                        if (json[i].Id != 0) {
                            optionsAsString += "<option value='" + json[i].Id + "'>" + json[i].Nombre + "</option>";
                        }
                    }
                    $('#PuertoOrigenEditar').append(optionsAsString);
                    $('#PuertoOrigenEditar').selectpicker('refresh');
                    $('#PuertoDestinoEditar').append(optionsAsString);
                    $('#PuertoDestinoEditar').selectpicker('refresh');
                },
            });

            $.ajax({
                type: "POST",
                url: '@Url.Action("GetNaves", "Nave")',
                async: false,
                success: function (response) {
                    var data = [];
                    var json = JSON.parse(response);
                    var cuenta = json.length;
                    var optionsAsString = "";
                    $('#NaveEditar').empty();
                    optionsAsString = "<option value='0' selected>Seleccione Nave</option>";
                    for (var i = 0; i < cuenta; i++) {
                        if (json[i].IdNave != 0) {
                            optionsAsString += "<option value='" + json[i].IdNave + "'>" + json[i].NombreNave + "</option>";
                        }
                    }
                    $('#NaveEditar').append(optionsAsString);
                    $('#NaveEditar').selectpicker('refresh');
                },
            });

            $.ajax({
                type: "POST",
                url: '@Url.Action("GetInfoViaje", "Viaje")',
                async: false,
                data: {IdViaje: $("#IdViaje").val()},
                success: function (response) {
                    var data = [];
                    var json = JSON.parse(response);
                    var cuenta = json.length;
                    if (cuenta != 0) {
                        $("#ViajeEditar").val(json.NumeroViaje);
                        $("#PuertoOrigenEditar").val(json.IdPuertoOrigen);
                        $("#PuertoOrigenEditar").selectpicker("refresh");
                        $("#PuertoDestinoEditar").val(json.IdPuertoDestino);
                        $("#PuertoDestinoEditar").selectpicker("refresh");
                        $("#NaveEditar").val(json.IdNave);
                        $("#NaveEditar").selectpicker("refresh");
                        $("#InicioStackingEditar").val(formatDate(json.InicioStacking));
                        $("#TerminoStackingEditar").val(formatDate(json.FinStacking));
                        $("#EtdEditar").val(formatDate(json.Etd));
                        $("#EtaNaveEditar").val(formatDate(json.EtaNave));
                        $("#EtaPODEditar").val(formatDate(json.EtaPod));
                    }
                },
            });

        } else {
            swal('Ups!', '<span class="alerta" key="erroreditarsolicitudvacio">Debes seleccionar un viaje para editarlo</span>', 'error');
            return false;
        }

    });
    //boton crear puerto//


    //Ingresar Información//
    $("#AgregarViaje").click(function () {
        if ($("#Viaje").val() != "") {
            $("#Viaje").css("background-color", "rgba(255, 0, 0, 0)");
            if ($("#PuertoOrigen").val() != "0") {
                $("button[data-id=PuertoOrigen]").css("background", "rgba(255, 0, 0, 0)");
                if ($("#PuertoDestino").val() != "0") {
                    $("button[data-id=PuertoDestino]").css("background", "rgba(255, 0, 0, 0)");
                    if ($("#Nave").val() != "0") {
                        $("button[data-id=Nave]").css("background", "rgba(255, 0, 0, 0)");
                        if ($("#EtaNave").val() != "") {
                            $("#EtaNave").css("background-color", "rgba(255, 0, 0, 0)");
                                    if ($("#Etd").val() != "") {
                                        $("#Etd").css("background-color", "rgba(255, 0, 0, 0)");

                                             $.ajax({
                                                 type: "POST",
                                                 url: '@Url.Action("CrearViaje", "Viaje")',
                                                 data: {
                                                     Viaje: $("#Viaje").val(), PuertoOrigen: $("#PuertoOrigen").val(),
                                                     PuertoDestino: $("#PuertoDestino").val(), Nave: $("#Nave").val(),
                                                     EtaNave: $("#EtaNave").val(), InicioStacking: $("#InicioStacking").val(),
                                                     TerminoStacking: $("#TerminoStacking").val(), Etd: $("#Etd").val(),
                                                     EtaPOD: $("#EtaPOD").val(), Estado: $("#Estado").val()
                                                 },
                                                 success: function (response) {
                                                     var json = JSON.parse(response);
                                                     if (json.validador == 0) {
                                                         var aux = 'success';
                                                     } else {
                                                         var aux = 'warning';
                                                     }
                                                     swal({
                                                         title: '',
                                                         text: json.Mensaje,
                                                         type: aux,
                                                         showCancelButton: false,
                                                         confirmButtonColor: '#3085d6',
                                                         cancelButtonColor: '#d33',
                                                         confirmButtonText: 'Aceptar'
                                                     }).then((result) => {
                                                         location.reload();
                                                     })
                                                 }
                                             });
                                    } else {
                                        $("#Etd").css("background-color", "rgba(255, 0, 0, 0.4)");
                                    }
                        } else {
                            $("#EtaNave").css("background-color", "rgba(255, 0, 0, 0.4)");
                        }
                    } else {
                        $("button[data-id=Nave]").css("background", "rgba(255, 0, 0, 0.4)");
                    }
                }else
                {
                    $("button[data-id=PuertoDestino]").css("background", "rgba(255, 0, 0, 0.4)");
                }
            } else {
                $("button[data-id=PuertoOrigen]").css("background", "rgba(255, 0, 0, 0.4)");
            }
        } else {
            $("#Viaje").css("background-color", "rgba(255, 0, 0, 0.4)");
        }
    });
    //Ingresar Información//

    //Editar Información//
    $("#EditarInformacion").click(function () {
         if ($("#ViajeEditar").val() != "") {
             $("#ViajeEditar").css("background-color", "rgba(255, 0, 0, 0)");
             if ($("#PuertoOrigenEditar").val() != "0") {
                 $("button[data-id=PuertoOrigenEditar]").css("background", "rgba(255, 0, 0, 0)");
                 if ($("#PuertoDestinoEditar").val() != "0") {
                     $("button[data-id=PuertoDestinoEditar]").css("background", "rgba(255, 0, 0, 0)");
                     if ($("#NaveEditar").val() != "0") {
                         $("button[data-id=NaveEditar]").css("background", "rgba(255, 0, 0, 0)");
                         if ($("#EtaNaveEditar").val() != "") {
                             $("#EtaNaveEditar").css("background-color", "rgba(255, 0, 0, 0)");
                             if ($("#InicioStackingEditar").val() != "") {
                                 $("#InicioStackingEditar").css("background-color", "rgba(255, 0, 0, 0)");
                                 if ($("#TerminoStackingEditar").val() != "") {
                                     $("#TerminoStackingEditar").css("background-color", "rgba(255, 0, 0, 0)");
                                     if ($("#EtdEditar").val() != "") {
                                         $("#EtdEditar").css("background-color", "rgba(255, 0, 0, 0)");
                                         if ($("#EtaPODEditar").val() != "") {
                                             $("#EtaPODEditar").css("background-color", "rgba(255, 0, 0, 0)");

                                             $.ajax({
                                                 type: "POST",
                                                 url: '@Url.Action("EditarViaje", "Viaje")',
                                                 data: {
                                                     IdViaje: $("#IdViaje").val(), Viaje: $("#ViajeEditar").val(),
                                                     PuertoOrigen: $("#PuertoOrigenEditar").val(), PuertoDestino: $("#PuertoDestinoEditar").val(),
                                                     Nave: $("#NaveEditar").val(), EtaNave: $("#EtaNaveEditar").val(),
                                                     InicioStacking: $("#InicioStackingEditar").val(), TerminoStacking: $("#TerminoStackingEditar").val(),
                                                     Etd: $("#EtdEditar").val(), EtaPOD: $("#EtaPODEditar").val(), Estado: $("#EstadoEditar").val()
                                                 },
                                                 success: function (response) {
                                                     var json = JSON.parse(response);
                                                     if (json.validador == 0) {
                                                         var aux = 'success';
                                                     } else {
                                                         var aux = 'warning';
                                                     }
                                                     swal({
                                                         title: '',
                                                         text: json.Mensaje,
                                                         type: aux,
                                                         showCancelButton: false,
                                                         confirmButtonColor: '#3085d6',
                                                         cancelButtonColor: '#d33',
                                                         confirmButtonText: 'Aceptar'
                                                     }).then((result) => {
                                                         location.reload();
                                                     })
                                                 }
                                             });
                                        } else {
                                             $("#EtaPODEditar").css("background-color", "rgba(255, 0, 0, 0.4)");
                                        }
                                    } else {
                                         $("#EtdEditar").css("background-color", "rgba(255, 0, 0, 0.4)");
                                    }
                                } else {
                                     $("#TerminoStackingEditar").css("background-color", "rgba(255, 0, 0, 0.4)");
                                }
                            } else {
                                 $("#InicioStackingEditar").css("background-color", "rgba(255, 0, 0, 0.4)");
                            }
                        } else {
                             $("#EtaNaveEditar").css("background-color", "rgba(255, 0, 0, 0.4)");
                        }
                    } else {
                         $("button[data-id=NaveEditar]").css("background", "rgba(255, 0, 0, 0.4)");
                    }
                }else
                {
                     $("button[data-id=PuertoDestinoEditar]").css("background", "rgba(255, 0, 0, 0.4)");
                }
            } else {
                 $("button[data-id=PuertoOrigenEditar]").css("background", "rgba(255, 0, 0, 0.4)");
            }
        } else {
             $("#ViajeEditar").css("background-color", "rgba(255, 0, 0, 0.4)");
        }
    });
    //Editar Información//

    $("#ValidarViaje").click(function () {
        if ($("#IdViaje").val() != "") {
            $.ajax({
                type: "POST",
                url: '@Url.Action("ValidarViaje", "Viaje")',
                data: {
                    IdViaje: $("#IdViaje").val()
                },
                success: function (response) {
                    var json = JSON.parse(response);
                    if (json.validador == 0) {
                        var aux = 'success';
                    } else {
                        var aux = 'warning';
                    }
                    swal({
                        title: '',
                        text: json.Mensaje,
                        type: aux,
                        showCancelButton: false,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Aceptar'
                    }).then((result) => {
                        location.reload();
                    })
                }
            });
        } else {
            swal('Ups!', '<span class="alerta" key="erroreditarsolicitudvacio">Debes seleccionar un viaje para validarlo</span>', 'error');
            return false;
        }
    });

    $("#EliminarViaje").click(function () {
        if ($("#IdViaje").val() != "") {

            $.ajax({
                type: "POST",
                url: '@Url.Action("ValidarViajeConServicios", "Viaje")',
                data: {
                    IdViaje: $("#IdViaje").val()
                },
                success: function (response) {
                    var json = JSON.parse(response);
                    if (json.validador == 0) {
                        var aux = 'success';

                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("EliminarViaje", "Viaje")',
                            data: {
                                IdViaje: $("#IdViaje").val()
                            },
                            success: function (response) {
                                var json = JSON.parse(response);
                                if (json.validador == 0) {
                                    var aux = 'success';
                                } else {
                                    var aux = 'warning';
                                }
                                swal({
                                    title: '',
                                    text: json.Mensaje,
                                    type: aux,
                                    showCancelButton: false,
                                    confirmButtonColor: '#3085d6',
                                    cancelButtonColor: '#d33',
                                    confirmButtonText: 'Aceptar'
                                }).then((result) => {
                                    location.reload();
                                })
                            }
                        });
                    } else {
                        swal('Ups!', '<span class="alerta" key="erroreditarsolicitudvacio">No se puede eliminar un viaje con servicios asociados.</span>', 'error');
                        return false;
                    }
                 
                }
            });
        } else {
            swal('Ups!', '<span class="alerta" key="erroreditarsolicitudvacio">Debes seleccionar un viaje para validarlo</span>', 'error');
            return false;
        }
    });

    $(function () {
        $("#InicioStacking,#TerminoStacking,#Etd,#EtaNave,#EtaPOD,#InicioStackingEditar,#TerminoStackingEditar,#EtdEditar,#EtaNaveEditar,#EtaPODEditar").datepicker({
            dateFormat: "dd-mm-yy",
            firstDay: 1,
            dayNamesMin: ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa"],
            dayNamesShort: ["Dom", "Lun", "Mar", "Mie", "Jue", "Vie", "Sab"],
            monthNames:
                ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio",
                "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
            monthNamesShort:
                ["Ene", "Feb", "Mar", "Abr", "May", "Jun",
                "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
            showWeek: true
        });
    });

    $("#InicioStacking").change(function () {
        if($("#TerminoStacking").val()!=""){
            var diainicio = $("#InicioStacking").val().substring(0, 2);
            var mesinicio = $("#InicioStacking").val().substring(3, 5);
            var anoinicio = $("#InicioStacking").val().substring(6, 10);
            var diatermino = $("#TerminoStacking").val().substring(0, 2);
            var mestermino = $("#TerminoStacking").val().substring(3, 5);
            var anotermino = $("#TerminoStacking").val().substring(6, 10);
            var inicio = new Date(mesinicio + "/" + diainicio + "/" + anoinicio);
            var termino = new Date(mestermino + "/" + diatermino + "/" + anotermino);
            if (termino.getTime() < inicio.getTime())
            {
                $("#InicioStacking").val("");
                swal('Ups!', 'Fecha Inicio de Stacking debe ser menor a la fecha Termino Stacking', 'error');
            }
        }
    });

    $("#TerminoStacking").change(function () {
        if ($("#InicioStacking").val() != "") {
            var diainicio = $("#InicioStacking").val().substring(0, 2);
            var mesinicio = $("#InicioStacking").val().substring(3, 5);
            var anoinicio = $("#InicioStacking").val().substring(6, 10);
            var diatermino = $("#TerminoStacking").val().substring(0, 2);
            var mestermino = $("#TerminoStacking").val().substring(3, 5);
            var anotermino = $("#TerminoStacking").val().substring(6, 10);
            var inicio = new Date(mesinicio + "/" + diainicio + "/" + anoinicio);
            var termino = new Date(mestermino + "/" + diatermino + "/" + anotermino);
            if (termino.getTime() < inicio.getTime()) {
                $("#TerminoStacking").val("");
                swal('Ups!', 'Fecha Termino de Stacking debe ser mayor a la fecha Inicio Stacking', 'warning');
            }
        }
    });

    $("#Etd").change(function () {
        if ($("#EtaPOD").val() != "") {
            var diaetd = $("#Etd").val().substring(0, 2);
            var mesetd = $("#Etd").val().substring(3, 5);
            var anoetd = $("#Etd").val().substring(6, 10);
            var diaeta = $("#EtaPOD").val().substring(0, 2);
            var meseta = $("#EtaPOD").val().substring(3, 5);
            var anoeta = $("#EtaPOD").val().substring(6, 10);
            var etd = new Date(mesetd + "/" + diaetd + "/" + anoetd);
            var eta = new Date(meseta + "/" + diaeta + "/" + anoeta);
            if (eta.getTime() < etd.getTime()) {
                $("#Etd").val("");
                swal('Ups!', 'ETD debe ser menor al ETA POD', 'warning');
                return false;
            }
        }

        if ($("#EtaNave").val() != "") {
            var diaetd = $("#Etd").val().substring(0, 2);
            var mesetd = $("#Etd").val().substring(3, 5);
            var anoetd = $("#Etd").val().substring(6, 10);
            var diaeta = $("#EtaNave").val().substring(0, 2);
            var meseta = $("#EtaNave").val().substring(3, 5);
            var anoeta = $("#EtaNave").val().substring(6, 10);
            var etd = new Date(mesetd + "/" + diaetd + "/" + anoetd);
            var eta = new Date(meseta + "/" + diaeta + "/" + anoeta);
            if (eta.getTime() > etd.getTime()) {
                $("#EtaNave").val("");
                swal('Ups!', 'ETD debe ser mayor al ETA de la Nave', 'warning');
                return false;
            }
        }

    });

    $("#EtaPOD").change(function () {
        if ($("#Etd").val() != "") {
            var diaetd = $("#Etd").val().substring(0, 2);
            var mesetd = $("#Etd").val().substring(3, 5);
            var anoetd = $("#Etd").val().substring(6, 10);
            var diaeta = $("#EtaPOD").val().substring(0, 2);
            var meseta = $("#EtaPOD").val().substring(3, 5);
            var anoeta = $("#EtaPOD").val().substring(6, 10);
            var etd = new Date(mesetd + "/" + diaetd + "/" + anoetd);
            var eta = new Date(meseta + "/" + diaeta + "/" + anoeta);
            if (eta.getTime() < etd.getTime()) {
                $("#EtaPOD").val("");
                swal('Ups!', 'ETA POD debe ser mayor al ETD', 'warning');
            }
        }
    });

    
    $("#EtaNave").change(function () {
        if ($("#Etd").val() != "") {
            var diaetd = $("#Etd").val().substring(0, 2);
            var mesetd = $("#Etd").val().substring(3, 5);
            var anoetd = $("#Etd").val().substring(6, 10);
            var diaeta = $("#EtaNave").val().substring(0, 2);
            var meseta = $("#EtaNave").val().substring(3, 5);
            var anoeta = $("#EtaNave").val().substring(6, 10);
            var etd = new Date(mesetd + "/" + diaetd + "/" + anoetd);
            var eta = new Date(meseta + "/" + diaeta + "/" + anoeta);
            if (eta.getTime() > etd.getTime()) {
                $("#EtaNave").val("");
                swal('Ups!', 'ETA Nave debe ser menor al ETD', 'warning');
            }
        }
    });

    

    $("#InicioStackingEditar").change(function () {
        if($("#TerminoStackingEditar").val()!=""){
            var diainicio = $("#InicioStackingEditar").val().substring(0, 2);
            var mesinicio = $("#InicioStackingEditar").val().substring(3, 5);
            var anoinicio = $("#InicioStackingEditar").val().substring(6, 10);
            var diatermino = $("#TerminoStackingEditar").val().substring(0, 2);
            var mestermino = $("#TerminoStackingEditar").val().substring(3, 5);
            var anotermino = $("#TerminoStackingEditar").val().substring(6, 10);
            var inicio = new Date(mesinicio + "/" + diainicio + "/" + anoinicio);
            var termino = new Date(mestermino + "/" + diatermino + "/" + anotermino);
            if (termino.getTime() < inicio.getTime())
            {
                $("#InicioStackingEditar").val("");
                swal('Ups!', 'Fecha Inicio de Stacking debe ser menor a la fecha Termino Stacking', 'error');
            }
        }
    });

    $("#TerminoStackingEditar").change(function () {
        if ($("#InicioStackingEditar").val() != "") {
            var diainicio = $("#InicioStackingEditar").val().substring(0, 2);
            var mesinicio = $("#InicioStackingEditar").val().substring(3, 5);
            var anoinicio = $("#InicioStackingEditar").val().substring(6, 10);
            var diatermino = $("#TerminoStackingEditar").val().substring(0, 2);
            var mestermino = $("#TerminoStackingEditar").val().substring(3, 5);
            var anotermino = $("#TerminoStackingEditar").val().substring(6, 10);
            var inicio = new Date(mesinicio + "/" + diainicio + "/" + anoinicio);
            var termino = new Date(mestermino + "/" + diatermino + "/" + anotermino);
            if (termino.getTime() < inicio.getTime()) {
                $("#TerminoStackingEditar").val("");
                swal('Ups!', 'Fecha Termino de Stacking debe ser mayor a la fecha Inicio Stacking', 'warning');
            }
        }
    });

    $("#EtdEditar").change(function () {
        if ($("#EtaPODEditar").val() != "") {
            var diaetd = $("#EtdEditar").val().substring(0, 2);
            var mesetd = $("#EtdEditar").val().substring(3, 5);
            var anoetd = $("#EtdEditar").val().substring(6, 10);
            var diaeta = $("#EtaPODEditar").val().substring(0, 2);
            var meseta = $("#EtaPODEditar").val().substring(3, 5);
            var anoeta = $("#EtaPODEditar").val().substring(6, 10);
            var etd = new Date(mesetd + "/" + diaetd + "/" + anoetd);
            var eta = new Date(meseta + "/" + diaeta + "/" + anoeta);
            if (eta.getTime() < etd.getTime()) {
                $("#EtdEditar").val("");
                swal('Ups!', 'ETD debe ser menor al ETA POD', 'warning');
                return false;
            }
        }
    });

    $("#EtaPODEditar").change(function () {
        if ($("#EtdEditar").val() != "") {
            var diaetd = $("#EtdEditar").val().substring(0, 2);
            var mesetd = $("#EtdEditar").val().substring(3, 5);
            var anoetd = $("#EtdEditar").val().substring(6, 10);
            var diaeta = $("#EtaPODEditar").val().substring(0, 2);
            var meseta = $("#EtaPODEditar").val().substring(3, 5);
            var anoeta = $("#EtaPODEditar").val().substring(6, 10);
            var etd = new Date(mesetd + "/" + diaetd + "/" + anoetd);
            var eta = new Date(meseta + "/" + diaeta + "/" + anoeta);
            if (eta.getTime() < etd.getTime()) {
                $("#EtaPODEditar").val("");
                swal('Ups!', 'ETA POD debe ser mayor al ETD', 'warning');
            }
        }
    });

    function formatDate(date) {
        if (date != null) {
            var fecha = date.substring(0, 10);
            var ano = date.substring(0, 4);
            var mes = date.substring(5, 7);
            var dia = date.substring(8, 10);
            return dia + "-" + mes + "-" + ano;
        } else {
            return "";
        }
    }

</script>

