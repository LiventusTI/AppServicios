
@{
    ViewBag.Title = "VisualizarSetpoints";
    Layout = "~/Views/MasterPage.cshtml";
}

<div class="col-sm-12">
    <div class="x_panel">
        <div class="x_title">
            <div class="row">
                <div class="col-sm-7">
                    <h2 class="tr" key="mantendorsetpoint">Gestionar / Visualizar Set Points</h2>
                </div>
                <div class="col-sm-3">
                    <button type="button" class="btn btn-success tr" id="CrearSetpoint" key="botonagregarsetpoint">Agregar Set Point</button>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="x_content">
            <div class="row">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <table id="Tb_Setpoint" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>ID SET POINT</th>
                                <th class="tr" key="tablacantidadco2">CANTIDAD CO2</th>
                                <th class="tr" key="tablacantidado2">CANTIDAD O2</th>
                                <th class="tr" key="tablaestado">ESTADO</th>
                                <th class="tr" key="tablaopciones">OPCIONES</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!--Modal para agregar datos-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="margin-left:80px; margin-right:10px;">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" style="width:100%">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel2"></h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label for="CO2" class="alerta col-sm-2 control-label" key="cantidadco2">Cantidad CO2 (*)</label>
                            <div class="col-sm-10">
                                <input type="number" step="0.1" min="0" class="form-control" id="CO2">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="CO" class="alerta col-sm-2 control-label" key="cantidado2">Cantidad O2 (*)</label>
                            <div class="col-sm-10">
                                <input type="number" step="0.1" min="0" class="form-control" id="CO">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="Estado" class="alerta col-sm-2 control-label" key="estado">Estado</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="Estado">
                                    <option value="0">Activo</option>
                                    <option value="1">Deshabilitado</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success tr" id="IngresarInformacion" key="botonagregarsetpoint">Agregar Set Point</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal para agregar datos-->
    <!--Modal para editar datos-->
    <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="margin-left:80px; margin-right:10px;">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" style="width:100%">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel2"></h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label for="CO2Editar" class="alerta col-sm-2 control-label" key="cantidadco2">Cantidad CO2 (*)</label>
                            <div class="col-sm-10">
                                <input type="number" step="0.1" min="0" class="form-control" id="CO2Editar">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="COEditar" class="alerta col-sm-2 control-label" key="cantidado2">Cantidad O2 (*)</label>
                            <div class="col-sm-10">
                                <input type="number" step="0.1" min="0" class="form-control" id="COEditar">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="EstadoEditar" class="alerta col-sm-2 control-label" key="estado">Estado</label>
                            <div class="col-sm-10">
                                <select class="form-control" id="EstadoEditar">
                                    <option value="0">Activo</option>
                                    <option value="1">Deshabilitado</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success editar tr" id="EditarInformacion" key="botoneditarsetpoint">Editar Setpoint</button>
                </div>
            </div>
        </div>
    </div>
    <!--Modal para editar datos-->
    <input type="text" class="input form_control" id="idsetpoint" disabled="disabled" style="text-align:center; text-align-last:center;" hidden />
    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" id="CrearSetpointModal" style="display:none;"></button>
    <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal2" id="EditarSetpointModal" style="display:none;"></button>
</div>


<script type="text/javascript">

    var lenguaje = document.cookie;


    $(document).ready(function () {
        $.ajax({
            type: "POST",
            url: '@Url.Action("GetSetpoint", "Setpoint")',
            success: function (response) {
                var data = [];
                var json = JSON.parse(response);
                var cuenta = json.length;
                $('#Tb_Setpoint').show(500);
                for (var i = 0 ; i < cuenta ; i++) {
                    if (json[i].Activo == 0) {
                        var estado = 'Activo';
                    } else {
                        var estado = 'No Activo';
                    }
                    data.push([json[i].IdSetpoint, json[i].CO2, json[i].O2, estado]);
                }

                if (lenguaje == "es") {
                    var table = $('#Tb_Setpoint').DataTable({
                        data: data,
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
                        },
                        fixedColumns: true,
                        "columnDefs": [{
                            "targets": -1,
                            "data": null,
                            "defaultContent": "<i class='fa fa-edit fa-2x' title='Editar Commodity'></i>"
                        }],
                        "rowCallback": function (row, data, index) {
                            if (data[0] == 0) {
                                $('td:eq(4)', row).html(' ');
                            }
                        }
                    });
                } else {
                    var table = $('#Tb_Setpoint').DataTable({
                        data: data,
                        fixedColumns: true,
                        "columnDefs": [{
                            "targets": -1,
                            "data": null,
                            "defaultContent": "<i class='fa fa-edit fa-2x' title='Editar Commodity'></i>"
                        }],
                        "rowCallback": function (row, data, index) {
                            if (data[0] == 0) {
                                $('td:eq(4)', row).html(' ');
                            }
                        }
                    });
                }


                $('#Tb_Setpoint tbody').on('click', 'i', function () {
                    var data = table.row($(this).parents('tr')).data();

                    $('#CO2Editar').focus();
                    $('#CO2Editar').val(data[1]);
                    $("#CO2Editar").css("background-color", "rgba(255, 0, 0, 0)");
                    $('#COEditar').focus();
                    $('#COEditar').val(data[2]);
                    $("#COEditar").css("background-color", "rgba(255, 0, 0, 0)");
                    $("#idsetpoint").val(data[0]);
                    $('#EditarSetpointModal').trigger('click');
                });
            },
        });
    });

    //boton crear commodity//
    $("#CrearSetpoint").click(function () {
        $('#CrearSetpointModal').trigger('click');
        $("#CO2").val("");
        $("#CO2").css("background-color", "rgba(255, 0, 0, 0)");
        $('#CO2').focus();
        $("#CO").val("");
        $("#CO").css("background-color", "rgba(255, 0, 0, 0)");
        $('#CO').focus();
    });
    //boton crear commodity//

    //Ingresar Información//
    $("#IngresarInformacion").click(function () {
        if ($("#CO2").val() != "") {
            $("#CO2").css("background-color", "rgba(255, 0, 0, 0)");
            if ($("#CO").val() != "") {
                $("#CO").css("background-color", "rgba(255, 0, 0, 0)");
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("CrearSetpoint", "Setpoint")',
                        data: { CO2: $("#CO2").val(), O2: $("#CO").val(), Estado: $("#Estado").val() },
                        success: function (response) {
                            var json = JSON.parse(response);
                            if (json.validador == 0) {
                                var aux = 'success';
                            } else {
                                var aux = 'warning';
                            }
                            swal({
                                title: '',
                                text: json.Mensaje,
                                type: aux,
                                showCancelButton: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar'
                            }).then((result) => {
                                location.reload();
                            })
                        }
                    });
            } else {
                $("#CO").css("background-color", "rgba(255, 0, 0, 0.4)");
            }
        } else {
            $("#CO2").css("background-color", "rgba(255, 0, 0, 0.4)");
        }
    });
    //Ingresar Información//

    //Editar Información//
    $("#EditarInformacion").click(function () {
        if ($("#CO2Editar").val() != "") {
            $("#CO2Editar").css("background-color", "rgba(255, 0, 0, 0)");
            if ($("#COEditar").val() != "") {
                $("#COEditar").css("background-color", "rgba(255, 0, 0, 0)");
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("EditarSetpoint", "Setpoint")',
                        data: { CO2: $("#CO2Editar").val(), O2: $("#COEditar").val(), Estado: $("#EstadoEditar").val(), IdSetpoint: $("#idsetpoint").val() },
                        success: function (response) {
                            var json = JSON.parse(response);
                            if (json.validador == 0) {
                                var aux = 'success';
                            } else {
                                var aux = 'warning';
                            }
                            swal({
                                title: '',
                                text: json.Mensaje,
                                type: aux,
                                showCancelButton: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Aceptar'
                            }).then((result) => {
                                location.reload();
                            })
                        }
                    });
            } else {
                $("#COEditar").css("background-color", "rgba(255, 0, 0, 0.4)");
            }
        } else {
            $("#CO2Editar").css("background-color", "rgba(255, 0, 0, 0.4)");
        }
    });
    //Editar Información//

</script>

